#tag DesktopWindow
Begin DesktopWindow Main
   Backdrop        =   0
   BackgroundColor =   &c00000000
   Composite       =   False
   DefaultLocation =   2
   FullScreen      =   False
   HasBackgroundColor=   True
   HasCloseButton  =   True
   HasFullScreenButton=   False
   HasMaximizeButton=   True
   HasMinimizeButton=   True
   Height          =   720
   ImplicitInstance=   True
   MacProcID       =   0
   MaximumHeight   =   32000
   MaximumWidth    =   32000
   MenuBar         =   ""
   MenuBarVisible  =   False
   MinimumHeight   =   400
   MinimumWidth    =   600
   Resizeable      =   True
   Title           =   "LastOSLinux Store"
   Type            =   0
   Visible         =   False
   Width           =   1280
   Begin DesktopCanvas ScreenShot
      AllowAutoDeactivate=   True
      AllowFocus      =   False
      AllowFocusRing  =   False
      AllowTabs       =   False
      Backdrop        =   0
      Enabled         =   True
      Height          =   397
      Index           =   -2147483648
      Left            =   569
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   False
      LockRight       =   True
      LockTop         =   True
      Scope           =   0
      TabIndex        =   2
      TabPanelIndex   =   0
      TabStop         =   False
      Tooltip         =   ""
      Top             =   29
      Transparent     =   False
      Visible         =   True
      Width           =   705
   End
   Begin DesktopListBox Items
      AllowAutoDeactivate=   False
      AllowAutoHideScrollbars=   True
      AllowExpandableRows=   False
      AllowFocusRing  =   True
      AllowResizableColumns=   False
      AllowRowDragging=   False
      AllowRowReordering=   False
      Bold            =   False
      ColumnCount     =   1
      ColumnWidths    =   ""
      DefaultRowHeight=   -1
      DropIndicatorVisible=   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      GridLineStyle   =   0
      HasBorder       =   False
      HasHeader       =   False
      HasHorizontalScrollbar=   False
      HasVerticalScrollbar=   True
      HeadingIndex    =   -1
      Height          =   657
      Index           =   -2147483648
      InitialValue    =   ""
      Italic          =   False
      Left            =   174
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      RequiresSelection=   False
      RowSelectionType=   0
      Scope           =   0
      TabIndex        =   0
      TabPanelIndex   =   0
      TabStop         =   True
      Tooltip         =   ""
      Top             =   29
      Transparent     =   False
      Underline       =   False
      Visible         =   True
      Width           =   389
      _ScrollOffset   =   0
      _ScrollWidth    =   -1
   End
   Begin DesktopTextArea Description
      AllowAutoDeactivate=   True
      AllowFocusRing  =   False
      AllowSpellChecking=   False
      AllowStyledText =   True
      AllowTabs       =   False
      BackgroundColor =   &c00000000
      Bold            =   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      Format          =   ""
      HasBorder       =   False
      HasHorizontalScrollbar=   False
      HasVerticalScrollbar=   True
      Height          =   122
      HideSelection   =   True
      Index           =   -2147483648
      Italic          =   False
      Left            =   569
      LineHeight      =   0.0
      LineSpacing     =   1.0
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   True
      LockTop         =   True
      MaximumCharactersAllowed=   0
      Multiline       =   True
      ReadOnly        =   True
      Scope           =   0
      TabIndex        =   3
      TabPanelIndex   =   0
      TabStop         =   False
      Text            =   "Welcome To LLStore."
      TextAlignment   =   0
      TextColor       =   &cFFFFFF00
      Tooltip         =   ""
      Top             =   431
      Transparent     =   False
      Underline       =   False
      UnicodeMode     =   1
      ValidationMask  =   ""
      Visible         =   True
      Width           =   705
   End
   Begin DesktopListBox Categories
      AllowAutoDeactivate=   True
      AllowAutoHideScrollbars=   True
      AllowExpandableRows=   False
      AllowFocusRing  =   True
      AllowResizableColumns=   False
      AllowRowDragging=   False
      AllowRowReordering=   False
      Bold            =   False
      ColumnCount     =   1
      ColumnWidths    =   ""
      DefaultRowHeight=   -1
      DropIndicatorVisible=   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      GridLineStyle   =   0
      HasBorder       =   False
      HasHeader       =   False
      HasHorizontalScrollbar=   False
      HasVerticalScrollbar=   True
      HeadingIndex    =   -1
      Height          =   657
      Index           =   -2147483648
      InitialValue    =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      RequiresSelection=   False
      RowSelectionType=   0
      Scope           =   0
      TabIndex        =   1
      TabPanelIndex   =   0
      TabStop         =   True
      Tooltip         =   ""
      Top             =   29
      Transparent     =   False
      Underline       =   False
      Visible         =   True
      Width           =   167
      _ScrollOffset   =   0
      _ScrollWidth    =   -1
   End
   Begin DesktopLabel CategoriesLabel
      AllowAutoDeactivate=   True
      Bold            =   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      Height          =   26
      Index           =   -2147483648
      InitialParent   =   ""
      Italic          =   False
      Left            =   7
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   False
      LockTop         =   True
      Multiline       =   False
      Scope           =   0
      Selectable      =   False
      TabIndex        =   4
      TabPanelIndex   =   0
      TabStop         =   False
      Text            =   "Categories"
      TextAlignment   =   2
      TextColor       =   &cFFFFFF00
      Tooltip         =   ""
      Top             =   0
      Transparent     =   True
      Underline       =   False
      Visible         =   True
      Width           =   122
   End
   Begin DesktopLabel ItemsLabel
      AllowAutoDeactivate=   True
      Bold            =   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      Height          =   26
      Index           =   -2147483648
      Italic          =   False
      Left            =   149
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   True
      LockTop         =   True
      Multiline       =   False
      Scope           =   0
      Selectable      =   False
      TabIndex        =   5
      TabPanelIndex   =   0
      TabStop         =   False
      Text            =   "Items"
      TextAlignment   =   2
      TextColor       =   &cFFFFFF00
      Tooltip         =   ""
      Top             =   0
      Transparent     =   True
      Underline       =   False
      Visible         =   True
      Width           =   399
   End
   Begin DesktopLabel TitleLabel
      AllowAutoDeactivate=   True
      Bold            =   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      Height          =   26
      Index           =   -2147483648
      Italic          =   False
      Left            =   575
      LockBottom      =   False
      LockedInPosition=   False
      LockLeft        =   False
      LockRight       =   True
      LockTop         =   True
      Multiline       =   False
      Scope           =   0
      Selectable      =   False
      TabIndex        =   6
      TabPanelIndex   =   0
      TabStop         =   False
      Text            =   "Title"
      TextAlignment   =   2
      TextColor       =   &cFFFFFF00
      Tooltip         =   ""
      Top             =   0
      Transparent     =   True
      Underline       =   False
      Visible         =   True
      Width           =   696
   End
   Begin DesktopLabel Stats
      AllowAutoDeactivate=   True
      Bold            =   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      Height          =   26
      Index           =   -2147483648
      Italic          =   False
      Left            =   149
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   True
      LockRight       =   True
      LockTop         =   False
      Multiline       =   False
      Scope           =   0
      Selectable      =   False
      TabIndex        =   7
      TabPanelIndex   =   0
      TabStop         =   False
      Text            =   "Stats"
      TextAlignment   =   2
      TextColor       =   &cFFFFFF00
      Tooltip         =   ""
      Top             =   689
      Transparent     =   True
      Underline       =   False
      Visible         =   True
      Width           =   399
   End
   Begin DesktopCanvas ItemFaderPic
      AllowAutoDeactivate=   True
      AllowFocus      =   False
      AllowFocusRing  =   True
      AllowTabs       =   False
      Backdrop        =   0
      Enabled         =   True
      Height          =   128
      Index           =   -2147483648
      Left            =   569
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   False
      LockRight       =   True
      LockTop         =   False
      Scope           =   0
      TabIndex        =   8
      TabPanelIndex   =   0
      TabStop         =   False
      Tooltip         =   ""
      Top             =   558
      Transparent     =   True
      Visible         =   True
      Width           =   128
   End
   Begin DesktopCanvas StartButton
      AllowAutoDeactivate=   False
      AllowFocus      =   True
      AllowFocusRing  =   True
      AllowTabs       =   False
      Backdrop        =   0
      Enabled         =   True
      Height          =   128
      Index           =   -2147483648
      Left            =   1146
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   False
      LockRight       =   True
      LockTop         =   False
      Scope           =   0
      TabIndex        =   2
      TabPanelIndex   =   0
      TabStop         =   True
      Tooltip         =   ""
      Top             =   558
      Transparent     =   True
      Visible         =   True
      Width           =   128
   End
   Begin Timer FirstShown
      Index           =   -2147483648
      LockedInPosition=   False
      Period          =   1
      RunMode         =   0
      Scope           =   0
      TabPanelIndex   =   0
   End
   Begin DesktopListBox MetaData
      AllowAutoDeactivate=   True
      AllowAutoHideScrollbars=   False
      AllowExpandableRows=   False
      AllowFocusRing  =   False
      AllowResizableColumns=   False
      AllowRowDragging=   False
      AllowRowReordering=   False
      Bold            =   False
      ColumnCount     =   1
      ColumnWidths    =   ""
      DefaultRowHeight=   -1
      DropIndicatorVisible=   False
      Enabled         =   True
      FontName        =   "System"
      FontSize        =   0.0
      FontUnit        =   0
      GridLineStyle   =   0
      HasBorder       =   False
      HasHeader       =   False
      HasHorizontalScrollbar=   False
      HasVerticalScrollbar=   False
      HeadingIndex    =   -1
      Height          =   128
      Index           =   -2147483648
      InitialValue    =   "https://www.LastOS.org\n\nWelcome to LLStore\nLastOS 2024"
      Italic          =   False
      Left            =   701
      LockBottom      =   True
      LockedInPosition=   False
      LockLeft        =   False
      LockRight       =   True
      LockTop         =   False
      RequiresSelection=   False
      RowSelectionType=   0
      Scope           =   0
      TabIndex        =   10
      TabPanelIndex   =   0
      TabStop         =   False
      Tooltip         =   ""
      Top             =   558
      Transparent     =   False
      Underline       =   False
      Visible         =   True
      Width           =   441
      _ScrollOffset   =   0
      _ScrollWidth    =   -1
   End
   Begin Timer KeyTimer
      Index           =   -2147483648
      LockedInPosition=   False
      Period          =   1000
      RunMode         =   0
      Scope           =   0
      TabPanelIndex   =   0
   End
   Begin Timer DoContextTimer
      Index           =   -2147483648
      LockedInPosition=   False
      Period          =   200
      RunMode         =   0
      Scope           =   0
      TabPanelIndex   =   0
   End
End
#tag EndDesktopWindow

#tag WindowCode
	#tag Event
		Function CancelClosing(appQuitting As Boolean) As Boolean
		  If ForceQuit = False Then
		    If StoreMode = 0 Or StoreMode = 1 Then Loading.SavePosition 'Only save if Store or Launcher
		    Main.Hide
		    PreQuitApp
		    QuitApp
		    Return False
		  Else
		    Return False
		  End If
		End Function
	#tag EndEvent

	#tag Event
		Sub Closing()
		  Debug("-- Main Closed")
		End Sub
	#tag EndEvent

	#tag Event
		Function KeyDown(key As String) As Boolean
		  'MsgBox Str(asc(Key))
		  'if Keyboard.ControlKey then MessageBox "Control key was pressed."
		  If Keyboard.ControlKey And 1 = 2 Then 'Disabled as it doesn't work in Windows, but having it in the KeyUp in The Items List works on both.
		    Dim Successed As Boolean
		    If Asc(Key) = 65 Or Asc(Key) = 97 Then SelectItems ("Select All") 'Ctrl + A or a
		    If Asc(Key) = 78 Or Asc(Key) = 110 Then SelectItems ("Select None") 'Ctrl + N or n
		    If Asc(Key) = 73 Or Asc(Key) = 105 Then SelectItems ("Select Invert") 'Ctrl + I or i
		    
		    If Asc(Key) = 79 Or Asc(Key) = 111 Then Successed = LoadFromPreset() 'Ctrl + O or o
		    If Asc(Key) = 83 Or Asc(Key) = 115 Then SaveToPreset() 'Ctrl + S or s
		    If Asc(Key) = 76 Or Asc(Key) = 108 Then SaveCurrentList() 'Ctrl + L or l
		    
		    If Asc(Key) = 84 Or Asc(Key) = 116 Or Asc(Key) = 20 Then Tools.Show 'Ctrl + T or t '20 is T in Windows
		    
		    Return True
		  End If
		  
		  'Added Below to ignore all Ctrl presses so it doen't jump to the letters
		  If Keyboard.ControlKey Then
		    Return True
		  End If
		  
		  If Asc(Key) = 194 Or Asc(Key) = 204 Then 'F5 194 in Linux 204 in Windows?
		    Loading.RefreshDBs
		  End If
		  
		  If Asc(Key) = 195 Or Asc(Key) = 205 Then 'F6 194 in Linux 204 in Windows?
		    AddManualLocation()
		  End If
		  
		  If Asc(Key) = 196 Or Asc(Key) = 206 Then 'F7 (Linux and Windows)
		    If StoreMode = 0 Then
		      StoreMode = 1
		    Else
		      StoreMode = 0
		    End If
		    ForceRefreshDBs = False
		    Main.Visible = False
		    
		    Dim RL As String
		    Dim F As FolderItem
		    Dim InputStream As TextInputStream
		    
		    'Get theme
		    If StoreMode = 0 Then
		      ThemePath = AppPath+"Themes/Theme.ini"
		      F = GetFolderItem(ThemePath,FolderItem.PathTypeNative)
		      InputStream = TextInputStream.Open(F)
		      RL = InputStream.ReadLine.Trim
		      inputStream.Close
		      ThemePath = AppPath+"Themes/"+RL+"/"
		      Loading.LoadTheme (RL)
		      Loading.Visible = True 'Show the loading form here
		    ElseIf StoreMode = 1 Then
		      ThemePath = AppPath+"Themes/ThemeLauncher.ini"
		      F = GetFolderItem(ThemePath,FolderItem.PathTypeNative)
		      InputStream = TextInputStream.Open(F)
		      RL = InputStream.ReadLine.Trim
		      inputStream.Close
		      ThemePath = AppPath+"Themes/"+RL+"/"
		      Loading.LoadTheme (RL)
		    End If
		    
		    'Load Settings
		    Loading.LoadSettings
		    
		    Loading.FirstRunTime.RunMode = Timer.RunModes.Single
		  End If
		  
		  If Asc(Key) = 197 Or Asc(Key) = 207 Then 'F8 (Linux and Windows) SETTINGS
		    Settings.Left = (Screen(0).AvailableWidth/2)-(Settings.Width/2)
		    Settings.Top = (Screen(0).AvailableHeight/2)-(Settings.Height/2)
		    If Settings.Visible = False Then Loading.LoadSettings 'Always reload settings when switching to it, just to make sure they match with whats stored, user has to press Save to update it
		    Settings.Show
		  End If
		  
		  If Asc(Key) = 198 Or Asc(Key) = 208 Then 'F9 (Linux and Windows) DEBUG
		    Data.Width = Main.Width
		    Data.Height = Main.Height
		    Data.Left = (screen(0).AvailableWidth - Data.Width) / 2 'Center Form
		    Data.top = (screen(0).AvailableHeight - Data.Height) / 2
		    Data.Show
		  End If
		  
		  'Do Editor
		  If Asc(Key) = 199 Or Asc(Key) = 209 Then 'F10 (Linux and Windows) Editor
		    'Load in Item fully
		    Dim Success As Boolean
		    #Pragma BreakOnExceptions Off
		    Try
		      Success = LoadLLFile(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("FileINI"))) ', "", True) 'The true means it extracts all the file contents, we'll just update existing ones if open then saving instead of Extracting the big ones
		      If Success Then
		        Editor.Left = (Screen(0).AvailableWidth/2) - (Editor.Width /2) 'Centered
		        Editor.Top = (Screen(0).AvailableHeight/2) - (Editor.Height /2)
		        Editor.PopulateData
		        Editor.Show
		      End If
		    Catch
		    End Try
		    #Pragma BreakOnExceptions On
		  End If
		  
		  If Asc(Key) = 200 Or Asc(Key) = 210 Then 'F11
		    Main.FullScreen = Not Main.FullScreen
		  End If
		  
		  
		  If StoreMode = 0 Then
		    If Asc(Key) = 13 Or Asc(Key) = 3 Or Asc(Key) = 32 Then 'Return and Enter and Space
		      If KeyBoard.AsyncControlKey Then
		        'Start Mini
		        
		        If SelectsCount >= 1 Then ' Must have selected one item
		          MiniInstaller.StartInstaller()
		        Else
		          If CurrentItemID >=0 Then
		            SelectsCount = 1 'Install current item
		            Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("Selected")) = "T" ' Select it
		            MiniInstaller.StartInstaller()
		          End If
		        End If
		        
		      Else
		        If CurrentItemID <> -1 Then
		          If IsTrue(Data.Items.CellTextAt(CurrentItemID,Data.GetDBHeader("Selected"))) Then
		            Data.Items.CellTextAt(CurrentItemID,Data.GetDBHeader("Selected")) = "F"
		          Else
		            Data.Items.CellTextAt(CurrentItemID,Data.GetDBHeader("Selected")) = "T"
		          End If
		          
		          Items.Refresh 'Force Redraw
		          UpdateStats 'Recount
		        End If
		        
		      End If
		    End If
		  End If
		  
		  If StoreMode = 1 Then
		    If Asc(Key) = 13 Or Asc(Key) = 3 Then 'Return and Enter
		      If KeyBoard.AsyncShiftKey Then
		        RunGame(CurrentItemID, True) 'True is Show Res
		      Else
		        RunGame(CurrentItemID)
		      End If
		    End If
		  End If
		  
		  'Typing text to find items
		  Dim KeyValue As Integer
		  Dim Found As Boolean
		  
		  KeyValue = Asc(Key)
		  'MsgBox Str(KeyValue)
		  
		  Dim I, EndCount As Integer
		  
		  Select Case KeyValue
		  Case 32, 48 To 57, 65 To 90, 97 To 122, 33, 39 To 41, 43 To 46, 91, 93, 95 'space, 0 - 9, A - Z, a-z, !'()+,-.[]_ - All the valid characters for ssWPI and SetupS
		    KeyTimer.Mode = 1
		    Typed=Typed + Key
		    Typing = True
		    EndCount = Items.RowCount - 1
		    For I = 0 To EndCount 'See if any list items start with the letters that the user has typed so far
		      If Left (Items.CellTextAt(I,0).Lowercase, Len(Typed)) = Typed.Lowercase Then
		        Items.SelectedRowIndex = I
		        Found = True
		        Exit For I 'Found a match so quit looking
		      End If
		    Next I
		    If Found = False Then 'Move down one if same first character
		      If Items.SelectedRowIndex <EndCount -1 Then
		        If Left(Typed.Lowercase,1) = Left(Items.CellTextAt(Items.SelectedRowIndex+1,0).Lowercase,1) Then ' Only if same first character on next item
		          Items.SelectedRowIndex = Items.SelectedRowIndex + 1
		        End If
		      End If
		    End If
		  Case 28 To 31, 8, 9, 127 'Arrow Keys, Backspace, TAB, or Delete erases ALL typing
		    Typing = False
		    Typed = ""
		  Case Else
		    Typing = False
		    Typed = ""
		  End Select
		  
		End Function
	#tag EndEvent

	#tag Event
		Sub Opening()
		  If Debugging Then Debug("--- Starting Main Opening ---")
		  If ForceQuit = True Then Return 'Don't bother even opening if set to quit
		  
		  TitleLabel.Text = "LLStore v"+ Str(App.MajorVersion)+"."+Str(App.MinorVersion) '+"."+Str(App.NonReleaseVersion)
		  
		  If TargetWindows Then 
		    TitleLabel.Text = TitleLabel.Text + " (Win)" + " " + SysDesktopEnvironment + " " + SysPackageManager
		    If IsAdmin Then TitleLabel.Text = TitleLabel.Text + " ~Admin"
		  End If
		  If TargetLinux Then TitleLabel.Text = TitleLabel.Text + " (Linux)" + " "  + SysDesktopEnvironment + " " + SysPackageManager
		  
		  'Do another Resize etc
		  FirstShown.RunMode = Timer.RunModes.Single
		End Sub
	#tag EndEvent

	#tag Event
		Sub Resized()
		  If Main.Width < 600 Then Main.Width = 600
		  If Main.Height < 400 Then Main.Height = 400
		  ResizeMainForm
		  
		  Items.Visible = True
		  Categories.Visible = True
		  
		End Sub
	#tag EndEvent

	#tag Event
		Sub Resizing()
		  Items.Visible = False
		  Categories.Visible = False
		  If Main.Width < 600 Then Main.Width = 600
		  If Main.Height < 400 Then Main.Height = 400
		  ResizeMainForm 'Might be too slow? Seems ok in Windows and Linux
		End Sub
	#tag EndEvent


	#tag Method, Flags = &h0
		Sub AddFavorite()
		  Dim I As Integer  
		  If CurrentCat = "Favorites" Then Return' Don't need to add it twice
		  If CurrentItemID = -1 Then Return 'No Item Text, skip
		  For I = 0 To FavCount - 1
		    If Favorites(I).Trim <> "" Then
		      If Favorites(I).Lowercase = Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("TitleName")).Lowercase Then Return 'Don't add Existing
		    End If
		  Next  
		  Favorites(FavCount) = Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("TitleName"))
		  FavCount = FavCount + 1
		  Loading.SaveFavorites
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub AddManualLocation(FolderIn As String = "")
		  Dim F As FolderItem
		  If FolderIn  = "" Then
		    Dim dlg As New SelectFolderDialog
		    dlg.ActionButtonCaption = "Add"
		    dlg.Title = "LLStore Add Manual Folder"
		    dlg.PromptText = "Add Manual Folder to Scan for Items"
		    'dlg.InitialDirectory = SpecialFolder.Documents
		    F = dlg.ShowModal
		  Else
		    F = GetFolderItem(FolderIn, FolderItem.PathTypeShell)
		  End If
		  If F <> Nil And F.Exists Then
		    Settings.SetManualLocations.Text = Settings.SetManualLocations.Text.Trim + Chr(10) + F.NativePath + Chr(10)
		    If TargetWindows Then Settings.SetManualLocations.Text = Settings.SetManualLocations.Text.ReplaceAll(Left(AppPath,2), "%USBDrive%") 'Convert Current USB drive to variable so when you load it back in it points to right location
		    
		    
		    Loading.SaveSettings
		    Loading.LoadSettings 'Make sure they get applied properly before reloading the GUI
		    Loading.RefreshDBs
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub ChangeCat(CatPicked As String)
		  CurrentCat = CatPicked
		  If LoadedMain = True Then LastUsedCategory = CurrentCat 'Only set it once loaded
		  
		  Dim I As Integer
		  For I = 0 To Categories.RowCount - 1
		    If Categories.CellTextAt(I,0) = CatPicked Then
		      Categories.RowSelectedAt(I) = True 'Highlight (So can call Progmatically to set it)
		      Exit 'Quit Loop once found
		    End If
		  Next
		  
		  GenerateItems
		  
		  #Pragma BreakOnExceptions Off
		  Try
		    ChangeItem(Items.CellTagAt(0,0))
		  Catch
		  End Try
		  
		  #Pragma BreakOnExceptions On
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub ChangeItem(CurrentItemIn As Integer)
		  If FirstRun = False Then Return  'Ignore doing this until the main form is shown and the Default text is set
		  
		  Dim WebWall As String
		  Dim F, G As FolderItem
		  
		  If CurrentItemIn >=0 Then CurrentItemID = CurrentItemIn
		  
		  'Resort Data by Ref or it fails to work
		  'Sort the Data (Need to be in order added once done sorting manually)
		  Data.Items.SortingColumn = 0
		  Data.Items.ColumnSortDirectionAt(0) = DesktopListBox.SortDirections.Ascending
		  Data.Items.Sort ()
		  
		  If StoreMode = 0 Then
		    TitleLabel.Text = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("TitleName")) +" "+Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("Version"))
		    TitleLabel.Text = TitleLabel.Text.Trim 'If no Version given, shorten name
		  Else
		    TitleLabel.Text = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("TitleName")) 'Don't show Version on Launcher
		    
		    'Change the Loaded ItemsLLItem to the current item so the Expanding Functions work
		    ItemLLItem.PathApp = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("PathINI"))
		    ItemLLItem.PathINI = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("PathINI"))
		    
		  End If
		  
		  'Get URL from PathIni
		  Dim ItemURL As String
		  ItemURL = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("PathINI"))
		  ItemURL = Left(ItemURL, InStrRev(ItemURL, "/")) ' Drop the Archive and just keep the path to use with Screenshots and Faders
		  
		  'Get UN Name (Universal Name)
		  Dim UN As String
		  UN = UniversalName(Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("TitleName"))+Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("BuildType")))
		  
		  'Get if URL Item
		  If Left(Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("PathINI")),4) = "http" Then 'FileIni has the local path, PathIni has the remote path
		    'It is
		    If Not Exist(Slash(RepositoryPathLocal)+".lldb/"+UN+".jpg") Then 'Download Screenshot
		      GetOnlineFile(ItemURL+".lldb/"+UN+".jpg", Slash(RepositoryPathLocal)+".lldb/"+UN+".jpg")
		    End If
		    If Not Exist(Slash(RepositoryPathLocal)+".lldb/"+UN+".png") Then 'Download Fader
		      GetOnlineFile(ItemURL+".lldb/"+UN+".png", Slash(RepositoryPathLocal)+".lldb/"+UN+".png")
		    End If
		  End If
		  
		  
		  'Screenshot
		  WebWall = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("FileScreenshot"))
		  If WebWall = "" Or Not Exist(WebWall) Then
		    WebWall = Slash(ThemePath) + "Screenshot.jpg" 'Default Theme Wallpaper used if no other given (could do Category Screenshots here if wanted)
		  End If
		  If TargetWindows Then
		    WebWall = WebWall.ReplaceAll("/","\")
		  Else
		    WebWall = WebWall.ReplaceAll("\","/")
		  End If
		  F = GetFolderItem(WebWall, FolderItem.PathTypeShell)
		  If Exist(WebWall) Then
		    ScreenShotCurrent = Picture.Open(F)
		  Else
		    ScreenShotCurrent = New Picture(Screen(0).AvailableWidth,Screen(0).AvailableHeight, 32)
		    ScreenShotCurrent.Graphics.DrawingColor = &C000000
		    ScreenShotCurrent.Graphics.FillRectangle(0,0,ScreenShotCurrent.Width,ScreenShotCurrent.Height)
		  End If
		  ScaleScreenShot
		  ScreenShot.Visible = True 'Show it again as default
		  
		  'Fader
		  WebWall = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("FileFader"))
		  If WebWall = "" Or Not Exist(WebWall) Then
		    WebWall = Slash(ThemePath) + "Icon.png" 'Default Theme Icon  used if no other given (could do Category Icons here if wanted)
		  End If
		  F = GetFolderItem(WebWall, FolderItem.PathTypeShell)
		  CurrentFader = Picture.Open(F)
		  
		  If RunningGame = True Then 
		    RunningGame = False
		  End If
		  
		  
		  ''If Main.Backdrop is nil then make it black
		  'If Main.Backdrop = Nil Then
		  'Main.Backdrop = New Picture(Screen(0).AvailableWidth,Screen(0).AvailableHeight)
		  'End If
		  
		  
		  'Clone From Wallpaper to Icon BG
		  #Pragma BreakOnExceptions Off
		  If ItemFaderPic.Backdrop <> Nil And Main.Backdrop <> Nil Then ' Only do if Valid
		    Try
		      ItemFaderPic.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,ItemFaderPic.Width, ItemFaderPic.Height, ItemFaderPic.Left, ItemFaderPic.Top, ItemFaderPic.Width, ItemFaderPic.Height)
		      'Draw Fader Icon on BG
		      ItemFaderPic.Backdrop.Graphics.DrawPicture(CurrentFader,0,0,ItemFaderPic.Width, ItemFaderPic.Height,0,0,CurrentFader.Width, CurrentFader.Height)
		      ItemFaderPic.Refresh
		    Catch
		    End Try
		  End If
		  #Pragma BreakOnExceptions On
		  
		  
		  'Description
		  
		  'Description.AllowStyledText = False 'Makes sure to have correct colours and fonts etc, no styled colors
		  Description.Bold = BoldDescription
		  Description.FontName = FontDescription
		  Description.TextColor = ColDescription
		  
		  Description.Text = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("Description")).ReplaceAll(Chr(30),Chr(13)) 'Added to here as the Data firm doesn't do it anymore
		  'Add extras so it shows Scrllbar always
		  If TargetLinux Then Description.Text = Description.Text + Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)+ Chr(13)
		  
		  Dim InstSize As Double
		  Dim License, Installed, InstSizeText, Categories, IsOnline As String
		  License = "Unknown" '0
		  If Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("License")) = "1" Then License = "Paid"
		  If Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("License")) = "2" Then License = "Free"
		  If Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("License")) = "3" Then License = "Open"
		  Installed = "No"
		  If Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("Installed")) = "T" Then Installed = "Yes"
		  
		  
		  Categories = Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("Categories")).ReplaceAll(";", ",")
		  If Right(Categories, 1) = "," Then Categories = Left(Categories, Len(Categories)-1) 'Removes Last Comma
		  
		  
		  'InstallSize
		  InstSize = Val(Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("InstalledSize")))
		  If Left(Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("BuildType")), 2) = "LL" Then
		    InstSize = InstSize / 1000
		  Else
		    InstSize = InstSize / 1000000 '(Convert To MB)
		  End If
		  
		  InstSizeText = InstSize.ToString("#.##") + " MB"
		  
		  'If InstSize > 0 Then
		  
		  IsOnline = "No"
		  If Left(Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("PathIni")), 2) = "ht" Then IsOnline = "Yes"
		  
		  'Meta Data
		  MetaData.RemoveAllRows
		  MetaData.AddRow ("URL:            " + Chr(9) + Data.Items.CellTextAt(CurrentItemIn, Data.GetDBHeader("URL")))
		  MetaData.AddRow ("Category:" + Chr(9) + Categories)
		  MetaData.AddRow ("License:   " + Chr(9) + License)
		  MetaData.AddRow ("Installed: " + Chr(9) + Installed)
		  MetaData.AddRow ("Size:            " + Chr(9) + InstSizeText)
		  MetaData.AddRow ("Online:      " + Chr(9) + IsOnline)
		  
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub DoContextMenu()
		  
		  Dim I As Integer
		  Dim Success As Boolean
		  
		  Dim base As New MenuItem
		  Dim M, hitItem As MenuItem
		  
		  Dim TrueFalse As Boolean
		  Dim ItemTypes() As String
		  Dim MC, TOI As Integer 'Menu Counter, as we'll be using the Text in the Select Case we don't need to know the Menu Number, Just increment it in code.
		  
		  MC = -1 ' Starts at 0, so We begin at -1 so we can increment right below the Append menu lines (to make sure we don't miss adding them)
		  
		  If StoreMode = 1 Then
		    base.Append New MenuItem("&Run With Resolution") '0
		    MC = MC + 1
		    base.Item(MC).Shortcut  = "Shift-Return"
		    
		    base.Append New MenuItem("Add Favorite") '0
		    MC = MC + 1
		    base.Item(MC).Shortcut  = "F"
		    base.Append New MenuItem("Remove Favorite") '0
		    MC = MC + 1
		    base.Item(MC).Shortcut  = "R"
		    
		    base.Append New MenuItem("Make Desktop Shortcut") '0
		    MC = MC + 1
		  End If
		  
		  
		  If StoreMode = 0 Then
		    base.Append New MenuItem("Selection") '0
		    MC = MC + 1
		    base.Item(MC).Append New MenuItem("Select All")
		    base.Item(MC).Append New MenuItem("Select None")
		    base.Item(MC).Append New MenuItem("Select Invert")
		    
		    base.Item(MC).Child("Select All").KeyboardShortcut = "A"
		    base.Item(MC).Child("Select None").KeyboardShortcut = "N"
		    base.Item(MC).Child("Select Invert").KeyboardShortcut = "I"
		    
		    base.Item(MC).Append New MenuItem(MenuItem.TextSeparator)
		    If Not TargetWindows Then base.Item(MC).Append New MenuItem("Select LLApps") 'Hides if in Windows
		    If Not TargetWindows Then base.Item(MC).Append New MenuItem("Select LLGames")
		    base.Item(MC).Append New MenuItem("Select ssApps")
		    base.Item(MC).Append New MenuItem("Select ppApps")
		    base.Item(MC).Append New MenuItem("Select ppGames")
		    base.Item(MC).Append New MenuItem("Select Internet Installer")
		    base.Item(MC).Append New MenuItem(MenuItem.TextSeparator)
		    If Not TargetWindows Then base.Item(MC).Append New MenuItem("Un-Select LLApps")
		    If Not TargetWindows Then base.Item(MC).Append New MenuItem("Un-Select LLGames")
		    base.Item(MC).Append New MenuItem("Un-Select ssApps")
		    base.Item(MC).Append New MenuItem("Un-Select ppApps")
		    base.Item(MC).Append New MenuItem("Un-Select ppGames")
		    base.Item(MC).Append New MenuItem("Un-Select Internet Installer")
		    
		    'MC = MC + 1
		    
		    base.Append New MenuItem("Hide") '0
		    MC = MC + 1
		    
		    M = New MenuItem
		    M.Text = "Installed"
		    M.Checked =  HideInstalled
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "Not Installed"
		    M.Checked =  HideNotInstalled
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "Online"
		    M.Checked =  HideOnline
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "Local"
		    M.Checked =  HideLocal
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "Internet Installer"
		    M.Checked =  HideInternetInstaller
		    base.Item(MC).Append M
		    
		    base.Item(MC).Append New MenuItem(MenuItem.TextSeparator) 'Sep
		    
		    M = New MenuItem
		    M.Text = "Paid"
		    M.Checked =  HidePaid
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "Free"
		    M.Checked =  HideFree
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "Open"
		    M.Checked =  HideOpen
		    base.Item(MC).Append M
		    
		    base.Item(MC).Append New MenuItem(MenuItem.TextSeparator) 'Sep
		    
		    M = New MenuItem
		    M.Text = "LLApps"
		    M.Checked =  HideLLApps
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "LLGames"
		    M.Checked =  HideLLGames
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "ssApps"
		    M.Checked =  HidessApps
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "ppApps"
		    M.Checked =  HideppApps
		    base.Item(MC).Append M
		    
		    M = New MenuItem
		    M.Text = "ppGames"
		    M.Checked =  HideppGames
		    base.Item(MC).Append M
		    
		    base.Item(MC).Append New MenuItem(MenuItem.TextSeparator) 'Sep
		    
		    M = New MenuItem
		    M.Text = "Unset Flags"
		    M.Checked =  HideUnsetFlags
		    base.Item(MC).Append M
		    
		    'Presets
		    base.Append New MenuItem("Load From Preset") '0
		    MC = MC + 1
		    base.Item(MC).Shortcut  = "O"
		    base.Append New MenuItem("Save To Preset") '0
		    MC = MC + 1
		    base.Item(MC).Shortcut  = "S"
		    
		    
		    
		  End If
		  
		  base.Append New MenuItem("Save Current &List") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "L"
		  
		  base.Append New MenuItem(MenuItem.TextSeparator) 'Sep
		  MC = MC + 1
		  
		  'Add to both
		  base.Append New MenuItem("Re(Scan) for Items") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F5"
		  
		  base.Append New MenuItem("Add &Manual Location") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F6"
		  
		  base.Append New MenuItem("&Change Mode (Store/Launcher)") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F7"
		  
		  base.Append New MenuItem(MenuItem.TextSeparator) 'Sep
		  MC = MC + 1
		  
		  'Last Item
		  base.Append New MenuItem("&Settings") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F8"
		  
		  'Debug
		  base.Append New MenuItem("&Debug") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F9"
		  
		  'Edit Item
		  base.Append New MenuItem("&Edit In LLEditor") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F10"
		  
		  'Full Screen
		  base.Append New MenuItem("Toggle Fullscreen") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "F11"
		  
		  'Tools Item
		  base.Append New MenuItem("LLStore &Tools") '0
		  MC = MC + 1
		  base.Item(MC).Shortcut  = "T"
		  
		  'Open Item Location
		  base.Append New MenuItem("Open Item Location") '0
		  MC = MC + 1 
		  
		  
		  '-------------------------------------------------------------------- Do Actions Below ----------------------------------------------------------------------
		  
		  'MsgBox"Here"
		  hitItem = base.Popup '**** Waits here for response
		  
		  If hitItem = Nil Then Return  'Nothing Picked
		  
		  Dim ContextText As String = hitItem.Text
		  
		  Select Case Left(hitItem.Text,7)
		    
		  Case "Toggle "
		    Main.FullScreen = Not Main.FullScreen
		  Case "Make De" 'Desktop Shortcut
		    Dim IconFile As String
		    IconFile = ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkIcon")))
		    If Not Exist(IconFile) Then IconFile = Slash(ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("PathApp"))))+"ppGame.png"
		    If Not Exist(IconFile) Then IconFile = Slash(ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("PathApp"))))+"LLGame.png"
		    'Need to add more icon file checks here, Like the Ones from Multi Link releases. Or make it generate them for the DB
		    
		    If TargetWindows Then
		      'I use the exe name as windows can't use png's, I don't want to include a converter... yet
		      CreateShortcut(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("TitleName")), Slash(ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkRunPath"))))+Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkExec")), ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkRunPath"))), Slash(FixPath(SpecialFolder.Desktop.NativePath)),"", Slash(ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkRunPath"))))+Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkExec")))
		    Else 'Linux
		      MakeLinuxLink(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("TitleName")), ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkExec"))), ExpPath(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("LnkRunPath"))), Slash(SpecialFolder.Desktop.NativePath), "", IconFile)
		    End If
		  Case "Save Cu" 'Save Current List
		    SaveCurrentList()
		  Case "Open It"
		    OpenItemLocation()
		  Case "LLStore"
		    'Tools.Visible = True
		    Tools.Show
		  Case "&Change"
		    Loading.SavePosition 'Save the current modes position
		    If StoreMode = 0 Then
		      StoreMode = 1
		    Else
		      StoreMode = 0
		    End If
		    ForceRefreshDBs = False
		    App.DoEvents(1)
		    Main.Visible = False
		    Loading.LoadSettings() 'Due to changing store mode, we need to change the scan paths
		    Loading.FirstRunTime.RunMode = Timer.RunModes.Single
		    Return 'Quit Main Loop and start it again
		  Case "Add Fav"
		    AddFavorite()
		  Case "Remove "
		    RemoveFavorite()
		  Case "Load Fr"
		    Success = LoadFromPreset()
		  Case "Save To"
		    SaveToPreset()
		  Case "Select "
		    SelectItems (ContextText)
		  Case "Un-Sele"
		    SelectItems (ContextText)
		  Case "&Run Wi"
		    RunGame(CurrentItemID, True)
		  Case "&Debug"
		    Data.Width = Main.Width
		    Data.Height = Main.Height
		    Data.Left = (screen(0).AvailableWidth - Data.Width) / 2 'Center Form
		    Data.top = (screen(0).AvailableHeight - Data.Height) / 2
		    Data.Show
		  Case "&Settin"
		    If Settings.Visible = False Then Loading.LoadSettings 'Always reload settings when switching to it, just to make sure they match with whats stored, user has to press Save to update it
		    Settings.Left = (Screen(0).AvailableWidth/2)-(Settings.Width/2)
		    Settings.Top = (Screen(0).AvailableHeight/2)-(Settings.Height/2)
		    Settings.Show
		  Case "Not Ins" ' Hide Not Installed
		    HideNotInstalled = Not HideNotInstalled
		    GenerateItems()
		  Case "Install" ' Hide Installed
		    HideInstalled = Not HideInstalled
		    GenerateItems()
		  Case "Online" ' Hide Online Items
		    HideOnline = Not HideOnline
		    GenerateItems()
		  Case "Local" ' Hide Local Items
		    HideLocal = Not HideLocal
		    GenerateItems()
		  Case "Interne" ' Hide Internet Installer Items
		    HideInternetInstaller = Not HideInternetInstaller
		    GenerateItems()
		  Case "Paid" ' Hide Paid Items
		    HidePaid = Not HidePaid
		    GenerateItems()
		  Case "Free" ' Hide Free Items
		    HideFree = Not HideFree
		    GenerateItems()
		  Case "Open" ' Hide Open Items
		    HideOpen = Not HideOpen
		    GenerateItems()
		  Case "LLApps" ' Hide
		    HideLLApps = Not HideLLApps
		    GenerateItems()
		  Case "LLGames" ' Hide 
		    HideLLGames= Not HideLLGames
		    GenerateItems()
		  Case "ssApps" ' Hide
		    HidessApps = Not HidessApps
		    GenerateItems()
		  Case "ppApps" ' Hide 
		    HideppApps = Not HideppApps
		    GenerateItems()
		  Case "ppGames" ' Hide
		    HideppGames= Not HideppGames
		    GenerateItems()
		  Case "Unset F" ' Hide
		    HideUnsetFlags = Not HideUnsetFlags
		    GenerateItems()
		  Case "Add &Ma"
		    AddManualLocation()
		  Case "Re(Scan"
		    Loading.SaveSettings
		    Loading.LoadSettings 'Make sure they get applied properly before reloading the GUI
		    Loading.RefreshDBs
		  Case "&Edit I"
		    'Load in Item fully
		    #Pragma BreakOnExceptions Off
		    Try
		      Success = LoadLLFile(Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("FileINI"))) ', "", True) 'The true means it extracts all the file contents, we'll just update existing ones if open then saving instead of Extracting the big ones
		      If Success Then
		        Editor.Left = (Screen(0).AvailableWidth/2) - (Editor.Width /2) 'Centered
		        Editor.Top = (Screen(0).AvailableHeight/2) - (Editor.Height /2)
		        Editor.PopulateData
		        Editor.Show
		      End If
		    Catch
		    End Try
		    #Pragma BreakOnExceptions On
		  End Select
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub GenerateCategories()
		  Dim I As Integer
		  
		  Main.Categories.RemoveAllRows 'Clear Main form
		  
		  'Add Perminant Sections Here
		  If StoreMode = 0 Then
		    Main.Categories.AddRow("All")
		    Main.Categories.AddRow("Games")
		    If TargetWindows Then
		    Else 'Linux offers both
		      Main.Categories.AddRow("Linux")
		      Main.Categories.AddRow("Windows")
		    End If
		  ElseIf StoreMode = 1 Then
		    Main.Categories.AddRow("All")
		    Main.Categories.AddRow("Favorites")
		    If TargetWindows Then
		    Else 'Linux offers both
		      Main.Categories.AddRow("Linux")
		      Main.Categories.AddRow("Windows")
		    End If
		  End If
		  
		  'Add Sorted Categories from Data form
		  For I = 0 To Data.Categories.RowCount - 1
		    Main.Categories.AddRow(Data.Categories.CellTextAt(I, 0))
		  Next
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub GenerateItems()
		  Items.RemoveAllRows 'Always Clear it before starting again
		  
		  'Resort Data by Ref or it fails to work
		  'Sort the Data (Need to be in order added once done sorting manually)
		  Data.Items.SortingColumn = 0
		  Data.Items.ColumnSortDirectionAt(0) = DesktopListBox.SortDirections.Ascending
		  Data.Items.Sort ()
		  
		  Dim DeTest As String
		  
		  Dim I As Integer
		  Dim J As Integer
		  Dim ItemToAdd As String
		  Dim Hidden As Boolean = False
		  Dim ItemCats, CCat As String
		  Dim ColBuildType As Integer = Data.GetDBHeader("BuildType")
		  
		  FirstItem = -1
		  
		  'Add Items From Data Table
		  For I = 0 To Data.Items.RowCount - 1
		    Hidden = False 'Show all items to start with
		    If Data.Items.CellTextAt(I, Data.GetDBHeader("Hidden")) = "T" Then Continue 'Skip Hidden items
		    
		    ItemToAdd = Data.Items.CellTextAt(I, Data.GetDBHeader("TitleName"))
		    
		    ItemCats = Data.Items.CellTextAt(I, Data.GetDBHeader("Categories")) 
		    
		    If CurrentCat <> "All" Then
		      If ItemCats.IndexOf(CurrentCat) < 0 Then Hidden = True 'Hide Categories to found in string
		      'MsgBox Str(ItemCats.IndexOf(CurrentCat)) +" "+CurrentCat+" = "+ ItemCats
		    End If
		    
		    'Not Needed As it'll hide itself below
		    'If CurrentCat = "Favorites" Then Hidden = False 'Show all on Favs as they get hidden by the scan below
		    
		    If CurrentCat = "Games" Then
		      If Data.Items.CellTextAt(I, ColBuildType) = "ppGame" Or Data.Items.CellTextAt(I, ColBuildType) = "LLGame" Then  Hidden = False
		    End If
		    
		    If CurrentCat = "Linux" Then
		      If Data.Items.CellTextAt(I, ColBuildType) = "LLApp" Or Data.Items.CellTextAt(I, ColBuildType) = "LLGame" Then  Hidden = False
		    End If
		    
		    If CurrentCat = "Windows" Then
		      If Data.Items.CellTextAt(I, ColBuildType) = "ppApp" Or Data.Items.CellTextAt(I, ColBuildType) = "ppGame" Or Data.Items.CellTextAt(I, ColBuildType) = "ssApp" Then  Hidden = False
		    End If
		    
		    If Left (CurrentCat, 5) = "Game " Then 'Show Game Categories properly
		      CCat = Right (CurrentCat,Len(CurrentCat) - 5)
		      If ItemCats.IndexOf(CCat) >= 0 Then
		        Hidden = False
		      Else
		        Hidden = True
		      End If
		    End If
		    
		    If StoreMode = 0 Then
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("Version")) <> "" Then ItemToAdd = ItemToAdd + " " + Data.Items.CellTextAt(I, Data.GetDBHeader("Version"))
		    End If
		    
		    If TargetWindows Then 'Hide all Linux stuff in Windows
		      If Data.Items.CellTextAt(I, ColBuildType) = "LLApp" Or Data.Items.CellTextAt(I, ColBuildType) = "LLGame" Or Data.Items.CellTextAt(I, ColBuildType) = "LLFile" Then  Hidden = True 'Hide Linux Items if in Windows
		    End If
		    
		    'Hide Conditions
		    If StoreMode = 0 Then ' Only do it for Installer
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("Installed")) = "T" And HideInstalled = True Then Hidden = True ' Hide Installed
		      
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("Installed")) = "F" And HideNotInstalled = True Then Hidden = True ' Hide Installed
		      
		      If Left(Data.Items.CellTextAt(I, Data.GetDBHeader("PathIni")), 2) = "ht" And HideOnline = True Then Hidden = True 'Hide Online
		      
		      If Left(Data.Items.CellTextAt(I, Data.GetDBHeader("PathIni")), 2) <> "ht" And HideLocal = True Then Hidden = True 'Hide Local items
		      
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("Flags")).IndexOf("internetrequired") >=0 And HideInternetInstaller = True Then Hidden = True 'Hide Internet Installer items
		      
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("BuildType")) = "LLApp" And HideLLApps = True Then Hidden = True ' Hide types
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("BuildType")) = "LLGame" And HideLLGames = True Then Hidden = True ' Hide
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("BuildType")) = "ssApp" And HidessApps = True Then Hidden = True ' Hide
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("BuildType")) = "ppApp" And HideppApps = True Then Hidden = True ' Hide
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("BuildType")) = "ppGame" And HideppGames = True Then Hidden = True ' Hide
		      
		      If Data.Items.CellTextAt(I, Data.GetDBHeader("DECompatible")) = "" And HideUnsetFlags = True Then Hidden = True ' Hide if Not set which Desktop Env's work with it
		      
		    End If
		    
		    If Data.Items.CellTextAt(I, Data.GetDBHeader("License")) = "1" And HidePaid = True Then Hidden = True 'Hide Paid
		    If Data.Items.CellTextAt(I, Data.GetDBHeader("License")) = "2" And HideFree = True Then Hidden = True 'Hide Free
		    If Data.Items.CellTextAt(I, Data.GetDBHeader("License")) = "3" And HideOpen = True Then Hidden = True 'Hide Open
		    
		    'Check Compatibility on Loading now, so no need to check each time it generates the Items List
		    If Data.Items.CellTextAt(I, Data.GetDBHeader("OSCompatible")) = "F" Then Hidden = True 'Hide if not Compatible DE or PM used
		    
		    If CurrentCat = "Favorites" Then
		      If StoreMode = 1 Then 'Launcher - Do Favorites
		        If FavCount >= 1 Then
		          Hidden = True
		          For J = 0 To FavCount - 1
		            If Data.Items.CellTextAt(I, Data.GetDBHeader("TitleName")) = Favorites(J) Then
		              Hidden = False
		              Continue
		            End If
		          Next
		        End If
		      End If
		    End If
		    
		    If StoreMode = 1 Then 'Make sure Launcher only shows Games
		      If Data.Items.CellTextAt(I, ColBuildType) = "ppGame" Or Data.Items.CellTextAt(I, ColBuildType) = "LLGame" Then
		      Else
		        Hidden = True
		      End If
		    End If
		    
		    
		    If Hidden = False Then 'If not set as Hidden add to the List (Show it)
		      Main.Items.AddRow(ItemToAdd)
		      If FirstItem = -1 Then FirstItem = Main.Items.LastAddedRowIndex
		      Main.Items.CellTagAt(Main.Items.LastAddedRowIndex, 0) = I 'This makes The Added Item have the Correct RefID for the main DB
		    End If
		  Next
		  
		  UpdateStats
		  
		  'Sort the list Alphabettic
		  Main.Items.SortingColumn = 0
		  Main.Items.ColumnSortDirectionAt(0) = DesktopListBox.SortDirections.Ascending
		  Main.Items.Sort ()
		  
		  If Main.Visible = True Then ' Don't do it before loaded main form
		    
		    If FirstItem <> -1 Then
		      Items.RowSelectedAt(FirstItem) = True
		      ChangeItem(Items.CellTagAt(FirstItem,0))
		    End If
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Function LoadFromPreset(PresetIn As String = "") As Boolean
		  If Data.Items.RowCount <= 0 Then Return False'No Items, no point trying to tick blankness
		  Dim I, J As Integer
		  Dim SelCount As Integer
		  Dim OutPut As String
		  Dim RL As String
		  Dim Sp() As String
		  
		  If Debugging Then Debug("--- Load From Preset: "+ PresetIn)
		  
		  Dim iniType As New FileType
		  iniType.Name = "text/ini"
		  iniType.MacType = "INI"
		  iniType.Extensions = "ini"
		  
		  If PreviousPresetPath = "" Then PreviousPresetPath = Slash(AppPath)+"Presets"
		  If TargetWindows = True Then
		    PreviousPresetPath = PreviousPresetPath.ReplaceAll("/","\")
		  Else
		    PreviousPresetPath = PreviousPresetPath.ReplaceAll("\","/")
		  End If
		  
		  If PresetIn = "" Then PresetIn = OpenDialog(iniType, "Select Preset .ini File", PreviousPresetPath) ' browse for one 
		  
		  If TargetWindows Then
		    PresetIn = PresetIn.ReplaceAll("/","\")
		  Else
		    PresetIn = PresetIn.ReplaceAll("\","/")
		  End If
		  
		  If PresetIn <> "" Then
		    If TargetWindows Then
		      PreviousPresetPath = Left(PresetIn, InStrRev(PresetIn,"\")) ' Get Parent
		    Else
		      PreviousPresetPath = Left(PresetIn, InStrRev(PresetIn,"/")) ' Get Parent
		    End If
		    
		    RL = LoadDataFromFile(PresetIn)
		    RL = RL.ReplaceAll(Chr(10),Chr(13)) 'Make able to Load Windows ones
		    RL = RL.ReplaceAll(Chr(13),Chr(10)) 'Make able to Load Windows ones, does it twice as to not make duplicates
		    Sp() = RL.Split(Chr(10))
		    If Sp.Count >=1 Then
		      For J = 0 To Data.Items.RowCount - 1 'Unselect all items first
		        Data.Items.CellTextAt(J, Data.GetDBHeader("Selected")) = "F"
		      Next
		      
		      For I = 0 To Sp.Count -1
		        If Left(Sp(I),2) = "1|" Then Sp(I) = Right (Sp(I),Len(Sp(I))-2)+"ssapp"
		        If Left(Sp(I),2) = "2|" Then Sp(I) = Right (Sp(I),Len(Sp(I))-2)+"ppapp"
		        If Left(Sp(I),2) = "3|" Then Sp(I) = Right (Sp(I),Len(Sp(I))-2)+"ppgame"
		        If Sp(I).Trim = "" Then Continue 'Skip empty items
		        'MsgBox Sp(I)
		        For J = 0 To Data.Items.RowCount - 1
		          If Sp(I).Trim = Data.Items.CellTextAt(J, Data.GetDBHeader("UniqueName")) And  Data.Items.CellTextAt(J, Data.GetDBHeader("Hidden")) <> "T" Then
		            Data.Items.CellTextAt(J, Data.GetDBHeader("Selected")) = "T"
		            Continue 'No Need to keep looking if it's already found it
		          End If
		        Next
		      Next
		      Items.Refresh 'Update Selection on Screen
		      UpdateStats
		      Return True
		    End If
		  End If
		  
		  Return False
		End Function
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub OpenItemLocation()
		  Dim Sh As New Shell
		  
		  If TargetWindows Then
		    #Pragma BreakOnExceptions Off
		    Try
		      Dim OpenPath As String
		      OpenPath = Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("FileINI")).ReplaceAll("/","\")
		      OpenPath = Left(OpenPath, InStrRev(OpenPath,"\")) 'Removes the Ini File name
		      If Exist(OpenPath) Then
		        Sh.Execute("explorer " + Chr(34) + OpenPath + Chr(34)) ' Open with default windows manager
		      End If
		    Catch
		    End Try
		    #Pragma BreakOnExceptions On
		  Else
		    #Pragma BreakOnExceptions Off
		    Try
		      Dim OpenPath As String
		      OpenPath = Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("FileINI")).ReplaceAll("\","/")
		      OpenPath = Left(OpenPath, InStrRev(OpenPath,"/")) 'Removes the Ini File name
		      If Exist(OpenPath) Then
		        ShellFast.Execute("xdg-open " + Chr(34) + OpenPath + Chr(34)+" &") ' Open with default windows manager
		      End If
		    Catch
		    End Try
		    #Pragma BreakOnExceptions On
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub RemoveFavorite()
		  Dim I As Integer  
		  If CurrentItemID = -1 Then Return 'No Item Text, skip
		  For I = 0 To FavCount - 1
		    If Favorites(I).Lowercase = Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("TitleName")).Lowercase  Then 
		      Favorites(I) = ""
		      If CurrentCat = "Favorites" Then GenerateItems
		      Loading.SaveFavorites
		      Return 'Only need to remove one
		    End If
		  Next 
		  Loading.SaveFavorites
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub ResizeMainForm()
		  Dim Padding As Integer = 2
		  Dim PaddingCat As Integer = 8 * (Main.Width/600)
		  Dim PaddingCatTop As Integer = ((Main.Height/20))-18
		  Dim PaddingMid As Integer = 8 * (Main.Width/360)'+10
		  
		  CategoriesLabel.Left= Padding + PaddingCat +6
		  CategoriesLabel.Top = Padding 
		  CategoriesLabel.Width = Main.Width / 5 - PaddingCat
		  CategoriesLabel.Height = 16 + PaddingCatTop
		  
		  CategoriesLabel.FontName = "Ubuntu"
		  ItemsLabel.FontName = "Ubuntu"
		  TitleLabel.FontName = "Ubuntu"
		  
		  CategoriesLabel.FontSize = (CategoriesLabel.Height/4.5)+8
		  ItemsLabel.FontSize = CategoriesLabel.FontSize
		  TitleLabel.FontSize = CategoriesLabel.FontSize
		  
		  ItemsLabel.Left = CategoriesLabel.Left+ CategoriesLabel.Width
		  ItemsLabel.Top = CategoriesLabel.Top
		  ItemsLabel.Width = (Main.Width / 3.45) - 6
		  ItemsLabel.Height = CategoriesLabel.Height
		  
		  TitleLabel.Left = ItemsLabel.Left + ItemsLabel.Width + PaddingMid
		  TitleLabel.Top = CategoriesLabel.Top
		  TitleLabel.Width =Main.Width - TitleLabel.Left - (PaddingMid/1.5) - 2
		  TitleLabel.Height = CategoriesLabel.Height
		  
		  ScreenShot.Left = TitleLabel.Left
		  ScreenShot.Top = TitleLabel.Top+16 +  PaddingCatTop + 2
		  ScreenShot.Width = TitleLabel.Width
		  ScreenShot.Height = Main.Height / 2.1
		  
		  Stats.Left=ItemsLabel.Left
		  Stats.Height = 24
		  Stats.Top = Main.Height - Stats.Height-(Main.Height/40)
		  Stats.Width = ItemsLabel.Width
		  
		  Categories.Left = CategoriesLabel.Left
		  Categories.Top = CategoriesLabel.Top +16 +  PaddingCatTop
		  Categories.Width = CategoriesLabel.Width
		  Categories.Height = Stats.Top - Categories.Top 
		  
		  Items.Left = ItemsLabel.Left
		  Items.Top = Categories.Top
		  Items.Width = ItemsLabel.Width
		  Items.Height = Stats.Top - Items.Top
		  
		  ItemFaderPic.Left = ScreenShot.Left
		  ItemFaderPic.Top =  (Stats.Top+Stats.Height) - ItemFaderPic.Height-6 - (PaddingCatTop/4)
		  'ItemIcon.Width = 128
		  'ItemIcon.Height= 128
		  
		  StartButton.Left = ScreenShot.Left+ScreenShot.Width - StartButton.Width
		  StartButton.Top = ItemFaderPic.Top
		  'StartButton.Width = 128
		  'StartButton.Height= 128
		  
		  'StartTabStop.Left = StartButton.Left
		  'StartTabStop.Top = StartButton.Top
		  'StartTabStop.Width = StartButton.Width
		  'StartTabStop.Height = StartButton.Height
		  
		  Description.Left = ScreenShot.Left
		  Description.Top= ScreenShot.Top + ScreenShot.Height + Padding
		  Description.Width = ScreenShot.Width
		  Description.Height = (ItemFaderPic.Top - (ScreenShot.Top+ScreenShot.Height)) - (Padding) -8 'Make a gap between Description and Icons
		  
		  If StartButton.Left - (ItemFaderPic.Left+ ItemFaderPic.Width) - Padding <= 200 Then 'If too small, hide the Icon
		    MetaData.Left = ItemFaderPic.Left
		    ItemFaderPic.Visible = False
		  Else
		    MetaData.Left = ItemFaderPic.Left + ItemFaderPic.Width + Padding
		    ItemFaderPic.Visible = True
		  End If
		  
		  MetaData.Top = ItemFaderPic.Top
		  MetaData.Width = StartButton.Left - MetaData.Left - Padding
		  MetaData.Height = ItemFaderPic.Height
		  
		  If LoadedMain = False Then Return 'It's not created yet, exit
		  
		  If ScaledWallpaper = Nil or AvailableWidth < Screen(0).AvailableWidth Then
		    ScaledWallpaper = New Picture(Screen(0).AvailableWidth,Screen(0).AvailableHeight, 32)
		    AvailableWidth = Screen(0).AvailableWidth
		  End If
		  
		  #Pragma BreakOnExceptions Off
		  Try
		    ScaledWallpaper.Graphics.DrawPicture(DefaultMainWallpaper,0, 0, Main.Width, Main.Height, 0, 0, DefaultMainWallpaper.Width, DefaultMainWallpaper.Height)
		    Main.Backdrop = ScaledWallpaper
		  Catch
		    'No Wallpaper Found Make it Black
		    ScaledWallpaper.Graphics.DrawingColor = &C000000
		    ScaledWallpaper.Graphics.FillRectangle(0,0,Main.Width,Main.Height)
		    Main.Backdrop = ScaledWallpaper
		  End Try
		  #Pragma BreakOnExceptions On
		  
		  
		  ScaleScreenShot
		  ScreenShot.Visible = True ' Bring it back
		  
		  'Make fader and Start Button Black so the non transparent description doesn't feel out of place
		  If StartButton.Backdrop = Nil Then
		    StartButton.Backdrop = New Picture(StartButton.Width,StartButton.Height, 32)
		  End If
		  StartButton.Backdrop.Graphics.DrawingColor = &C000000
		  Try
		    'Remarked below line to not have Black BG
		    'StartButton.Backdrop.Graphics.FillRectangle(0,0,StartButton.Width,StartButton.Height)
		  Catch
		  End Try
		  
		  'Clone From Wallpaper to Fader BG
		  StartButton.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,StartButton.Width, StartButton.Height, StartButton.Left, StartButton.Top, StartButton.Width, StartButton.Height)
		  'Draw Start Button over BG
		  #Pragma BreakOnExceptions Off
		  Try
		    StartButton.Backdrop.Graphics.DrawPicture(DefaultStartButton,0,0,StartButton.Width, StartButton.Height,0,0,DefaultStartButton.Width, DefaultStartButton.Height)
		  Catch
		  End Try
		  #Pragma BreakOnExceptions On
		  
		  If ItemFaderPic.Backdrop = Nil Then
		    ItemFaderPic.Backdrop = New Picture(ItemFaderPic.Width,ItemFaderPic.Height, 32)
		  End If
		  ItemFaderPic.Backdrop.Graphics.DrawingColor = &C000000
		  Try 
		    'Remarked below line to not have Black BG
		    'ItemFaderPic.Backdrop.Graphics.DrawingColor = &C000000
		    'ItemFaderPic.Backdrop.Graphics.FillRectangle(0,0,ItemIcon.Width,ItemIcon.Height)
		  Catch
		  End Try
		  
		  'Clone From Wallpaper to Icon BG
		  ItemFaderPic.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,ItemFaderPic.Width, ItemFaderPic.Height, ItemFaderPic.Left, ItemFaderPic.Top, ItemFaderPic.Width, ItemFaderPic.Height)
		  
		  'Draw Items Icon on BG
		  If CurrentFader = Nil Then CurrentFader = DefaultFader
		  #Pragma BreakOnExceptions Off
		  Try
		    ItemFaderPic.Backdrop.Graphics.DrawPicture(CurrentFader,0,0,ItemFaderPic.Width, ItemFaderPic.Height,0,0,DefaultFader.Width, DefaultFader.Height)
		  Catch
		  End Try
		  #Pragma BreakOnExceptions On
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub RunGame(GameIDIn As Integer, PickScreenRes As Boolean = False)
		  If Debugging Then Debug("--- Starting Run Game ---")
		  
		  If Debugging Then Debug("Starting: " + Data.Items.CellTextAt(GameIDIn, Data.GetDBHeader("TitleName")))
		  
		  RunningGame = True
		  If GameIDIn = -1 Then Return 'No Item given
		  
		  Dim PosLeft, PosTop, PosWidth, PosHeight As Integer
		  Dim Exe, BT As String
		  Dim Sh As New Shell
		  Dim ShWait As New Shell
		  Dim RunPath, Exec As String
		  Dim Success As Boolean
		  Dim Wid, Hit As String
		  Dim WinWid As String
		  
		  Sh.TimeOut = -1 'Give it All the time it needs
		  ShWait.TimeOut = -1 'Give it All the time it needs
		  
		  If Settings.SetAlwaysShowRes.Value = True Then PickScreenRes = True
		  
		  'Pick a Screen Resolution
		  If TargetLinux Then 'Only do Res stuff in Linux
		    If PickScreenRes = True Then
		      ScreenResolution.Left = (screen(0).AvailableWidth - ScreenResolution.Width) / 2 'Center Res Form
		      ScreenResolution.Top = (screen(0).AvailableHeight - ScreenResolution.Height) / 2
		      ScreenResolution.Show
		      While ScreenResolution.Visible
		        App.DoEvents(1)
		      Wend
		      
		      If ForceQuit Then
		        ScreenResolution.Close
		        Return  ' Forced Quit store, don't wait after form close, just quit
		      End If
		      
		      If ScreenRes = "" Then Return 'No Res selected, just abort
		    End If
		  Else
		    ScreenRes = "Desktop" 'Ignore Res stuff
		  End If
		  
		  'Store Windows Position to restore after game runs
		  PosLeft = Main.Left
		  PosTop = Main.Top
		  PosWidth = Main.Width
		  PosHeight = Main.Height
		  
		  'Hide Main Form
		  Main.Hide 'Hide main form
		  App.DoEvents(4) 'Wait .004 of a second
		  
		  WinWid = Screen(0).AvailableWidth.ToString
		  
		  RunPath = ExpPath(Data.Items.CellTextAt(GameIDIn, Data.GetDBHeader("LnkRunPath"))).Trim
		  If RunPath = "" Then RunPath = ExpPath(Data.Items.CellTextAt(GameIDIn, Data.GetDBHeader("PathApp")))
		  
		  Exec = ExpPath(Data.Items.CellTextAt(GameIDIn, Data.GetDBHeader("LnkExec")))
		  Exe = Exec
		  
		  'Best for Windows -------------------------------
		  If Left(Exe,1) <>Chr(34) Then ' This helps sometimes, it's all a mess and need a routine to build the command, save it to a script file to run instead
		    'Exe = Chr(34)+Slash(RunPath)+Exe+Chr(34) ' Try adding RunPath in
		    Exe = Chr(34)+Exe+Chr(34)
		  End If
		  
		  If TargetWindows Then ' Best Way for Windows
		    SaveDataToFile (Left(RunPath,2)+Chr(10)+"cd "+ Chr(34)+RunPath+Chr(34)+Chr(10)+Exe, Slash(TmpPath)+"LLRun.cmd")
		  End If
		  
		  '-------------------------------------------------
		  
		  'Make game run and wait for it to exit
		  Sh.ExecuteMode = Shell.ExecuteModes.Asynchronous
		  
		  'Set Current Directory
		  Success = ChDirSet(RunPath) 
		  
		  If ScreenRes = "Desktop" Then ScreenRes = "" 'Clear Desktop once passed cancel test
		  
		  If TargetLinux Then 'Grab Screen res to restore after game run
		    ShWait.Execute ("xrandr --current | grep current | awk '{print $8}'")
		    Wid = ShWait.Result
		    ShWait.Execute ("xrandr --current | grep current | awk '{print $10}'")
		    Hit = ShWait.Result
		    
		    Wid = Wid.Trim
		    Hit = Hit.Replace(",", "") 'Only one can use Replace, not ReplaceAll
		  End If
		  
		  BT = Data.Items.CellTextAt(GameIDIn, Data.GetDBHeader("BuildType"))
		  If BT = "ppGame" Then
		    If TargetWindows Then
		      'BELOW line WORKS PERFECT!
		      Sh.Execute("cmd.exe /c",Slash(TmpPath)+"LLRun.cmd")
		    Else 'Running ppGame in Linux
		      
		      If ScreenRes <> "" Then 'Change to Picked Res
		        
		        ShWait.Execute (ToolPath+"BackupWineDPI.sh")
		        ShWait.Execute (ToolPath+"DefaultWineDPI.sh")
		        
		        Sh.Execute ("xrandr -s " +ScreenRes + " ; wine explorer /desktop=name," + ScreenRes + " " + Exe)
		      Else 'No Res or Desktop mode set
		        Sh.Execute ("wine " +  Exe) 'Adding z:/ Allows it to run from any path, Need to test without it.
		      End If
		      
		    End If
		  Else ' Linux Game
		    If TargetWindows Then
		      Sh.Execute (Exe)
		    Else
		      If ScreenRes <> "" Then 'Change to Picked Res
		        
		        Sh.Execute ("xrandr -s " +ScreenRes + " ; " + Exe)
		        
		      Else 'No Res Given
		        Sh.Execute (Exe) 'Was just set to Exec
		        'Sh.Execute (ToolPath +"run-1080p "+ Exec)
		        
		      End If
		    End If
		  End If
		  
		  While Sh.IsRunning
		    App.DoEvents(7)
		  Wend
		  If TargetWindows Then
		    'Wait for Screen Res to go back to default for 4 seconds
		    'If ScreenRes <> "" Then
		    Dim Waits As Integer
		    While Waits < 100
		      App.DoEvents(40)
		      Waits = Waits + 1
		      If Screen(0).AvailableWidth.ToString = WinWid Then Waits = Waits + 5
		    Wend
		    'End If
		  Else 'Is Linux
		    'If Settings.SetRecoverScreenRes.Value = True Then
		    If Wid = "0" Then Wid = ""
		    If Wid <> "" Then ' Put Orig Res back if changed
		      While ShWait.Result.Trim <> Wid ' Wait for Screen Width to be the original res
		        ShWait.Execute ("xrandr -s " + Wid + "x" + Hit) 'Keep Trying until it's set
		        App.DoEvents(1)
		        ShWait.Execute ("xrandr --current | grep current | awk '{print $8}'") ' Get current Width
		        App.DoEvents(1)
		      Wend
		    End If
		    'End If
		    ShWait.Execute (ToolPath+"RestoreWineDPI.sh")
		  End If
		  
		  App.DoEvents(40) 'Wait .04 of a second
		  
		  'Restore Position
		  Main.Left = PosLeft
		  Main.Top = PosTop
		  Main.Width = PosWidth
		  Main.Height = PosHeight
		  
		  App.DoEvents(40) 'Wait .04 of a second
		  Main.Show
		  App.DoEvents(40) 'Wait .04 of a second
		  'Restore Position
		  Main.Left = PosLeft
		  Main.Top = PosTop
		  Main.Width = PosWidth
		  Main.Height = PosHeight
		  
		  RunningGame = False 'Set this to false so it will play the movie next time you click an item, may be buggy and need disable
		  
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SaveCurrentList()
		  Dim OutText As String
		  Dim I As Integer
		  If Items.RowCount > 0 Then
		    For I = 0 To Items.RowCount - 1
		      OutText = OutText + Items.CellTextAt(I,0)+Chr(10)
		    Next 
		    SaveDataToFile(OutText, Slash(SpecialFolder.Desktop.NativePath)+"LLStore_CurrentList.txt")
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SaveToPreset()
		  If Data.Items.RowCount <= 0 Then Return 'No Items
		  Dim I As Integer
		  Dim SelCount As Integer
		  Dim OutPut As String
		  
		  Dim PresetFileName As String
		  Dim iniType As New FileType
		  iniType.Name = "text/ini"
		  iniType.MacType = "INI"
		  iniType.Extensions = "ini"
		  
		  For I = 0 To Data.Items.RowCount - 1
		    If Data.Items.CellTextAt(I, Data.GetDBHeader("Selected")) = "T" Then
		      OutPut = OutPut + Data.Items.CellTextAt(I, Data.GetDBHeader("UniqueName")) + Chr(10)
		      SelCount = SelCount + 1
		    End If
		  Next
		  If SelCount >= 1 Then
		    'Select a File to save to
		    If PreviousPresetPath = "" Then PreviousPresetPath = Slash(AppPath)+"Presets"
		    
		    If TargetWindows = True Then
		      PreviousPresetPath = PreviousPresetPath.ReplaceAll("/","\")
		    Else
		      PreviousPresetPath = PreviousPresetPath.ReplaceAll("\","/")
		    End If
		    
		    PresetFileName = SaveDialog(iniType, "Save Preset .ini File", PreviousPresetPath, "My Preset.ini")
		    
		    If PresetFileName <> "" Then
		      If TargetWindows Then
		        PreviousPresetPath = Left(PresetFileName, InStrRev(PresetFileName,"\"))
		      Else
		        PreviousPresetPath = Left(PresetFileName, InStrRev(PresetFileName,"/"))
		      End If
		      SaveDataToFile(OutPut, PresetFileName)
		    End If
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub ScaleScreenShot()
		  Dim SSScale As Double
		  Dim RealSSHeight, RealSSWidth, X, Y As Integer
		  
		  
		  If ScreenShotCurrent = Nil Or AvailableWidth < Screen(0).AvailableWidth Then
		    ScreenShotCurrent = New Picture(Screen(0).AvailableWidth,Screen(0).AvailableHeight, 32)
		    ScreenShotCurrent.Graphics.DrawingColor = &C000000
		    ScreenShotCurrent.Graphics.FillRectangle(0,0,ScreenShotCurrent.Width,ScreenShotCurrent.Height)
		  End If
		  
		  SSScale = ScreenShot.Width/ScreenShotCurrent.Width
		  RealSSHeight = ScreenShotCurrent.Height * SSScale
		  RealSSWidth = ScreenShot.Width
		  If RealSSHeight > ScreenShot.Height Then 'Make the PicScreenShotSource fit in the space allowed
		    
		    SSScale = ScreenShot.Height/ScreenShotCurrent.Height
		    RealSSWidth = ScreenShotCurrent.Width * SSScale
		    RealSSHeight= ScreenShot.Height
		  End If
		  X = (ScreenShot.Width - RealSSWidth) / 2
		  Y = (ScreenShot.Height - RealSSHeight) / 2
		  
		  If LoadedMain = False Then Return 'It's not created yet, exit
		  
		  If ScaledScreenShot = Nil or AvailableWidth < Screen(0).AvailableWidth Then
		    ScaledScreenShot = New Picture(Screen(0).AvailableWidth,Screen(0).AvailableHeight, 32)
		    AvailableWidth = Screen(0).AvailableWidth
		  End If
		  
		  'No Need to make black if always transparent
		  'ScaledScreenShot.Graphics.DrawingColor = &C000000
		  'ScaledScreenShot.Graphics.FillRectangle(0,0,ScaledScreenShot.Width,ScaledScreenShot.Height)
		  
		  'Grab Background of main form
		  ScaledScreenShot.Graphics.DrawPicture(Main.BackDrop,0, 0, ScreenShot.Width+1, ScreenShot.Height+1, ScreenShot.Left, ScreenShot.Top, ScreenShot.Width+1, ScreenShot.Height)
		  
		  ScaledScreenShot.Graphics.DrawPicture(ScreenShotCurrent,X,Y,RealSSWidth, RealSSHeight,0,0,ScreenShotCurrent.Width, ScreenShotCurrent.Height)
		  
		  ScreenShot.Backdrop = ScaledScreenShot
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub SelectItems(Inn As String)
		  Dim I As Integer
		  For I = 0 To Items.RowCount - 1
		    Select Case Inn
		    Case"Select All"
		      Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		    Case"Select None"
		      Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		    Case "Select Invert"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      Else
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Select LLApps"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "LLApp" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Un-Select LLApps"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "LLApp" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      End If
		    Case "Select LLGames"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "LLGame" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Un-Select LLGames"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "LLGame" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      End If
		    Case "Select ssApps"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "ssApp" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Un-Select ssApps"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "ssApp" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      End If
		    Case "Select ppApps"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "ppApp" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Un-Select ppApps"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "ppApp" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      End If
		    Case "Select ppGames"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "ppGame" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Un-Select ppGames"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("BuildType")) = "ppGame" Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      End If
		    Case "Select Internet Installer"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0), Data.GetDBHeader("Flags")).IndexOf("internetrequired") >=0  Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "T"
		      End If
		    Case "Un-Select Internet Installer"
		      If Data.Items.CellTextAt(Items.CellTagAt(I,0), Data.GetDBHeader("Flags")).IndexOf("internetrequired") >=0  Then
		        Data.Items.CellTextAt(Items.CellTagAt(I,0),Data.GetDBHeader("Selected")) = "F"
		      End If
		      
		    End Select
		  Next I
		  
		  Items.Refresh 'Update Selection on Screen
		  
		  UpdateStats
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub StartPushed()
		  Dim ColSelected As Integer = Data.GetDBHeader("Selected")
		  
		  Installing = False 'Clear the flag to make sure it only enabled if all is corect to.
		  
		  If StoreMode = 0 Then 'Installer
		    If SelectsCount >= 1 Then ' Must have selected one item
		      MiniInstallerShowing = True
		      MiniInstaller.StartInstaller()
		    Else
		      If CurrentItemID >=0 Then
		        SelectsCount = 1 'Install current item
		        Data.Items.CellTextAt(CurrentItemID, ColSelected) = "T" ' Select it
		        MiniInstallerShowing = True
		        MiniInstaller.StartInstaller()
		      End If
		    End If
		  End If
		  If StoreMode = 1 Then 'Launcher
		    If CurrentItemID >=0 Then 'If nothing picked, do nothing
		      RunGame(CurrentItemID)
		    End If
		  End If
		End Sub
	#tag EndMethod

	#tag Method, Flags = &h0
		Sub UpdateStats()
		  Dim I as Integer
		  SelectsCount = 0
		  For I = 0 To Main.Items.RowCount - 1
		    If Data.Items.CellTextAt(Items.CellTagAt(I,0), Data.GetDBHeader("Selected")) = "T" Then SelectsCount = SelectsCount + 1
		  Next I
		  If SelectsCount <= 0 Then
		    Stats.Text = Str(Items.RowCount) +" Items"
		  Else
		    Stats.Text = Str(SelectsCount)+"/"+Str(Items.RowCount) +" Items"
		  End If
		End Sub
	#tag EndMethod


	#tag Property, Flags = &h0
		CurrentCat As String
	#tag EndProperty

	#tag Property, Flags = &h0
		CurrentCatID As Integer
	#tag EndProperty

	#tag Property, Flags = &h0
		HideFree As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideInstalled As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideLLApps As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideLLGames As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideLocal As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideNotInstalled As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideOnline As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideOpen As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HidePaid As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideppApps As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideppGames As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HidessApps As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		HideUnsetFlags As Boolean = False
	#tag EndProperty

	#tag Property, Flags = &h0
		SelectsCount As Integer
	#tag EndProperty

	#tag Property, Flags = &h0
		Typed As String
	#tag EndProperty

	#tag Property, Flags = &h0
		Typing As Boolean
	#tag EndProperty

	#tag Property, Flags = &h0
		Untitled As Integer
	#tag EndProperty


#tag EndWindowCode

#tag Events Items
	#tag Event
		Function PaintCellText(g as Graphics, row as Integer, column as Integer, x as Integer, y as Integer) As Boolean
		  'If Main.Visible = False Then Return False ' Don't redraw if not seen 'This may be breaking Wayland, try this fix
		  #Pragma BreakOnExceptions False
		  
		  #PRAGMA unused x
		  #PRAGMA unused y
		  
		  Var icon As Picture
		  
		  Dim Pos As Integer
		  
		  Pos = 2+(g.Height / 6)
		  
		  'Get Item
		  Dim CLI, RefIcon As Integer
		  Try
		    CLI = Items.CellTagAt(Row, 0)
		  Catch
		    CLI = -1
		  End Try
		  
		  'Draw Text
		  Try
		    g.DrawingColor = ColList
		    g.FontName = FontList
		    g.Bold = BoldList
		  Catch
		  End Try
		  
		  Try
		    If IsTrue(Data.Items.CellTextAt(CLI,Data.GetDBHeader("Selected"))) Then g.Bold = Not BoldList 'Make Selected Items Bold oppsite to default items
		  Catch
		  End Try
		  
		  Try
		    If StoreMode = 0 Then 'Only color when in Installer mode
		      If CLI >=0 Then 
		        Select Case Data.Items.CellTextAt(CLI,Data.GetDBHeader("BuildType"))
		        Case "LLApp"
		          g.DrawingColor = ColLLApp
		        Case "LLGame"
		          g.DrawingColor = ColLLGame
		        Case "ssApp"
		          g.DrawingColor = ColssApp
		        Case "ppApp"
		          g.DrawingColor = ColppApp
		        Case "ppGame"
		          g.DrawingColor = ColppGame
		        End Select
		      End If
		    End If
		    g.DrawText(Items.CellTextAt(row, column), g.Height+2, g.Height-Pos)
		  Catch
		  End Try
		  
		  'Draw Icon
		  Try
		    RefIcon = Val(Data.Items.CellTextAt(CLI, Data.GetDBHeader("IconRef")))
		    icon = Data.Icons.RowImageAt(RefIcon)
		    g.DrawPicture(icon, 1, 1, g.Height-2,g.Height-2, _
		    0, 0, icon.Width, icon.Height)
		  Catch
		  End Try
		  
		  #Pragma BreakOnExceptions On
		  
		  Return True
		End Function
	#tag EndEvent
	#tag Event
		Function PaintCellBackground(g As Graphics, row As Integer, column As Integer) As Boolean
		  'If Main.Visible = False Then Return False ' Don't redraw if not seen 'This may be breaking Wayland, try this fix
		  
		  'Can Do Solid Color
		  'g.DrawingColor =  &C000000
		  'g.FillRectangle(0,0,g.Width, g.Height)
		  
		  'Draw Wallpaper (Transparent)
		  g.DrawPicture ScaledWallpaper, -Items.Left, (-Items.Top)-(row*me.RowHeight) +(Me.ScrollPosition*me.RowHeight)
		  
		  'Get Item
		  Dim CLI As Integer
		  #Pragma BreakOnExceptions Off
		  Try
		    'Nil error?
		    CLI = Items.CellTagAt(Row, 0)
		  Catch
		    CLI = -1
		  End Try
		  #Pragma BreakOnExceptions On
		  
		  
		  ''''**************************** Allow List to redraw while scrolling
		  ''RedrawList.Reset
		  
		  If CLI <> -1 Then 'Can't do this if not sure where the hell it is.
		    If IsTrue(Data.Items.CellTextAt(CLI,Data.GetDBHeader("Selected"))) And Me.SelectedRowIndex = Row Then  'If selected and Hilighted
		      g.ForeColor = ColDual
		      g.FillRect 0,0,g.Width, g.Height
		      Return True 'Take away drawing default Highlight
		    End If
		    
		    If IsTrue(Data.Items.CellTextAt(CLI,Data.GetDBHeader("Selected"))) Then 'Select items you double click on
		      g.ForeColor = ColSelect
		      g.FillRect 0,0,g.Width, g.Height
		    End If
		  End If
		  
		  Try
		    If Me.SelectedRowIndex = Row Then 'Highlight
		      g.ForeColor = ColHiLite
		      g.FillRect 0,0,g.Width, g.Height
		      Return True 'Take away drawing default Highlight
		    End If
		  Catch
		  End Try
		  
		  If CLI = -1 Then Return True ' Not an item, just skip it (Drawn BG above)
		  
		End Function
	#tag EndEvent
	#tag Event
		Function CellPressed(row As Integer, column As Integer, x As Integer, y As Integer) As Boolean
		  'Get Item
		  Dim CLI As Integer
		  '#Pragma BreakOnExceptions Off
		  Try
		    CLI = Items.CellTagAt(Row, 0)
		  Catch
		    CLI = -1
		  End Try
		  '#Pragma BreakOnExceptions On
		  
		  If CLI >= 0 Then
		    CurrentItemID = CLI
		    ChangeItem(CLI)
		  End If
		  
		End Function
	#tag EndEvent
	#tag Event
		Sub KeyUp(key As String)
		  Dim Successed As Boolean
		  If Keyboard.ControlKey Then
		    'MsgBox Str(asc(Key))
		    Select Case Asc(Key)
		    Case 45 '-
		      Items.FontSize = Items.FontSize - 1
		      If Items.FontSize <= 4 Then Items.FontSize = 4
		      Categories.FontSize = Items.FontSize
		      Description.FontSize = Items.FontSize
		    Case 61 '+
		      Items.FontSize = Items.FontSize + 1
		      If Items.FontSize >= 32 Then Items.FontSize = 32
		      Categories.FontSize = Items.FontSize
		      Description.FontSize = Items.FontSize
		    Case 97
		      SelectItems("Select All")
		    Case 110
		      SelectItems("Select None")
		    Case 105
		      SelectItems("Select Invert")
		    Case 111
		      Successed = LoadFromPreset()
		    Case 115
		      SaveToPreset()
		    Case 108
		      SaveCurrentList()
		    Case 116
		      Tools.Show
		    End Select
		  End If
		  
		  #Pragma BreakOnExceptions False
		  Try 
		    CurrentItemID = Items.CellTagAt (Items.SelectedRowIndex, 0)
		  Catch
		    CurrentItemID = -1
		  End Try
		  #Pragma BreakOnExceptions True
		  If CurrentItemID >= 0 Then ChangeItem(CurrentItemID)
		End Sub
	#tag EndEvent
	#tag Event
		Sub DoublePressed()
		  If StoreMode = 0 Then 'Select items to install
		    If IsTrue(Data.Items.CellTextAt(CurrentItemID,Data.GetDBHeader("Selected"))) Then
		      Data.Items.CellTextAt(CurrentItemID,Data.GetDBHeader("Selected")) = "F"
		    Else
		      Data.Items.CellTextAt(CurrentItemID,Data.GetDBHeader("Selected")) = "T"
		    End If
		    
		    Items.Refresh 'Force Redraw
		    
		    UpdateStats 'Recount
		  Else 'Run a game
		    RunGame (CurrentItemID)
		  End If
		End Sub
	#tag EndEvent
	#tag Event
		Sub MouseUp(x As Integer, y As Integer)
		  
		End Sub
	#tag EndEvent
	#tag Event
		Function MouseDown(x As Integer, y As Integer) As Boolean
		  'If WasContext = True Then Return True
		  If IsContextualClick Then
		    'WasContext = True
		    DoContextTimer.RunMode = Timer.RunModes.Single
		    Return False
		  End If
		End Function
	#tag EndEvent
	#tag Event
		Function MouseWheel(x As Integer, y As Integer, deltaX As Integer, deltaY As Integer) As Boolean
		  If Keyboard.AsyncControlKey Then 'Hold Ctrl to Zoom
		    If deltaY > 1 Then 'Zoom Out
		      Items.FontSize = Items.FontSize - 1
		      If Items.FontSize <= 4 Then Items.FontSize = 4
		    End If
		    
		    If deltaY < -1 Then 'Zoom In
		      Items.FontSize = Items.FontSize + 1
		      If Items.FontSize >= 32 Then Items.FontSize = 32
		    End If
		    Return True 'Stops Listbox Scrolling when zooming it
		  End If
		End Function
	#tag EndEvent
#tag EndEvents
#tag Events Description
	#tag Event
		Function MouseWheel(x As Integer, y As Integer, deltaX As Integer, deltaY As Integer) As Boolean
		  If Keyboard.AsyncControlKey Then 'Hold Ctrl to Zoom
		    If deltaY > 1 Then 'Zoom Out
		      Description.FontSize = Description.FontSize - 1
		      If Description.FontSize <= 4 Then Description.FontSize = 4
		    End If
		    
		    If deltaY < -1 Then 'Zoom In
		      Description.FontSize = Description.FontSize + 1
		      If Description.FontSize >= 32 Then Description.FontSize = 32
		    End If
		    Description.VerticalScrollPosition = 0 'Make Description jump back to top
		  End If
		End Function
	#tag EndEvent
	#tag Event
		Sub FocusReceived()
		  Items.SetFocus 'Don't allow focus on the Description at all
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events Categories
	#tag Event
		Function PaintCellBackground(g As Graphics, row As Integer, column As Integer) As Boolean
		  'If Main.Visible = False Then Return False ' Don't redraw if not seen 'This may be breaking Wayland, try this fix
		  Try
		    'Can Do Solid Color
		    'g.DrawingColor =  &C000000
		    'g.FillRectangle(0,0,g.Width, g.Height)
		    
		    'Draw Wallpaper (Transparent)
		    g.DrawPicture ScaledWallpaper, -Categories.Left, (-Categories.Top)-(row*me.RowHeight) +(Me.ScrollPosition*me.RowHeight)
		    
		    'Color HiLite
		    If Me.SelectedRowIndex = Row Then 'Highlight
		      g.ForeColor = ColHiLite
		      g.FillRect 0,0,g.Width, g.Height
		      Return True 'Take away drawing default Highlight
		    End If
		  Catch
		  End Try
		End Function
	#tag EndEvent
	#tag Event
		Function CellPressed(row As Integer, column As Integer, x As Integer, y As Integer) As Boolean
		  Try
		    CurrentCat = Categories.CellTextAt(Row, 0)
		    CurrentCatID = Row
		    CurrentCat = Categories.CellTextAt (Row, 0)
		  Catch
		  End Try
		  
		  If CurrentCat <> "" Then ChangeCat(CurrentCat)
		  
		  Items.SelectedRowIndex = 0
		  Items.SetFocus
		End Function
	#tag EndEvent
	#tag Event
		Sub KeyUp(key As String)
		  If Asc(Key) = 9 Then Return 'If tabbed in, don't do update
		  Try 
		    CurrentCatID = Categories.CellTagAt (Categories.SelectedRowIndex, 0)
		    CurrentCat = Categories.CellTextAt (Categories.SelectedRowIndex, 0)
		  Catch
		  End Try
		  
		  If CurrentCat <> "" Then ChangeCat(CurrentCat)
		End Sub
	#tag EndEvent
	#tag Event
		Function PaintCellText(g as Graphics, row as Integer, column as Integer, x as Integer, y as Integer) As Boolean
		  'If Main.Visible = False Then Return False ' Don't redraw if not seen 'This may be breaking Wayland, try this fix
		  Dim Pos As Integer
		  
		  Try
		    Pos = 2 + (g.Height / 6)
		    
		    g.DrawingColor = ColCategory
		    g.FontName = FontList
		    g.Bold = BoldList
		    g.DrawText(Categories.CellTextAt(row, column), 0, g.Height-Pos)
		    
		    Return True 'Disables Drawing original text too
		    
		  Catch
		  End Try
		End Function
	#tag EndEvent
	#tag Event
		Function MouseWheel(x As Integer, y As Integer, deltaX As Integer, deltaY As Integer) As Boolean
		  If Keyboard.AsyncControlKey Then 'Hold Ctrl to Zoom
		    If deltaY > 1 Then 'Zoom Out
		      Categories.FontSize = Categories.FontSize - 1
		      If Categories.FontSize <= 4 Then Categories.FontSize = 4
		    End If
		    
		    If deltaY < -1 Then 'Zoom In
		      Categories.FontSize = Categories.FontSize + 1
		      If Categories.FontSize >= 32 Then Categories.FontSize = 32
		    End If
		    Return True 'Stops Listbox Scrolling when zooming it
		  End If
		End Function
	#tag EndEvent
#tag EndEvents
#tag Events ItemFaderPic
	#tag Event
		Sub MouseUp(x As Integer, y As Integer)
		  Data.Width = Main.Width
		  Data.Height = Main.Height
		  
		  'Center Form
		  Data.Left = (screen(0).AvailableWidth - Data.Width) / 2
		  Data.top = (screen(0).AvailableHeight - Data.Height) / 2
		  
		  If Keyboard.ControlKey Then 'Holding Ctrl shows debugger
		    Data.Show
		  Else 'Draw Fader into Screenshot area at full size
		    Dim Cent As Integer
		    #Pragma BreakOnExceptions Off
		    Try
		      Cent = (ScreenShot.Width / 2)- (CurrentFader.Width/2)
		      ScreenShot.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,ScreenShot.Width, ScreenShot.Height, ScreenShot.Left, ScreenShot.Top, ScreenShot.Width, ScreenShot.Height)
		      ScreenShot.Backdrop.Graphics.DrawPicture(CurrentFader,Cent,0,CurrentFader.Width, CurrentFader.Height,0,0,CurrentFader.Width, CurrentFader.Height)
		      ScreenShot.Refresh
		    Catch
		    End Try
		    #Pragma BreakOnExceptions On
		  End If
		End Sub
	#tag EndEvent
	#tag Event
		Function MouseDown(x As Integer, y As Integer) As Boolean
		  Return True
		End Function
	#tag EndEvent
#tag EndEvents
#tag Events StartButton
	#tag Event
		Sub MouseEnter()
		  'Make fader and Start Button Black so the non transparent description doesn't feel out of place
		  If StartButton.Backdrop = Nil Then
		    StartButton.Backdrop = New Picture(StartButton.Width,StartButton.Height, 32)
		  End If
		  
		  'Clone From Wallpaper to Icon BG
		  StartButton.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,StartButton.Width, StartButton.Height, StartButton.Left, StartButton.Top, StartButton.Width, StartButton.Height)
		  
		  StartButton.Backdrop.Graphics.DrawPicture(DefaultStartButtonHover,0,0,StartButton.Width, StartButton.Height,0,0,DefaultStartButtonHover.Width, DefaultStartButtonHover.Height)
		  StartButton.Refresh
		  
		  
		End Sub
	#tag EndEvent
	#tag Event
		Sub MouseExit()
		  'Make fader and Start Button Black so the non transparent description doesn't feel out of place
		  If StartButton.Backdrop = Nil Then
		    StartButton.Backdrop = New Picture(StartButton.Width,StartButton.Height, 32)
		  End If
		  
		  'Clone From Wallpaper to Icon BG
		  StartButton.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,StartButton.Width, StartButton.Height, StartButton.Left, StartButton.Top, StartButton.Width, StartButton.Height)
		  
		  StartButton.Backdrop.Graphics.DrawPicture(DefaultStartButton,0,0,StartButton.Width, StartButton.Height,0,0,DefaultStartButton.Width, DefaultStartButton.Height)
		  StartButton.Refresh
		End Sub
	#tag EndEvent
	#tag Event
		Function MouseDown(x As Integer, y As Integer) As Boolean
		  Return True
		End Function
	#tag EndEvent
	#tag Event
		Sub MouseUp(x As Integer, y As Integer)
		  StartPushed()
		  
		  
		End Sub
	#tag EndEvent
	#tag Event
		Function KeyDown(key As String) As Boolean
		  If Asc(Key) = 9 Then Return False ' Allow Tabbing
		  
		  'MsgBox Asc(Key).ToString
		  Select Case Asc(Key)
		  Case 3, 13, 32
		    StartPushed
		  Case Else
		    Items.SetFocus
		    Return True
		  End Select
		  
		  Return True 'Take Event
		End Function
	#tag EndEvent
	#tag Event
		Sub FocusReceived()
		  'Make fader and Start Button Black so the non transparent description doesn't feel out of place
		  If StartButton.Backdrop = Nil Then
		    StartButton.Backdrop = New Picture(StartButton.Width,StartButton.Height, 32)
		  End If
		  
		  'Clone From Wallpaper to Icon BG
		  StartButton.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,StartButton.Width, StartButton.Height, StartButton.Left, StartButton.Top, StartButton.Width, StartButton.Height)
		  
		  StartButton.Backdrop.Graphics.DrawPicture(DefaultStartButtonHover,0,0,StartButton.Width, StartButton.Height,0,0,DefaultStartButtonHover.Width, DefaultStartButtonHover.Height)
		  StartButton.Refresh
		End Sub
	#tag EndEvent
	#tag Event
		Sub FocusLost()
		  'Make fader and Start Button Black so the non transparent description doesn't feel out of place
		  If StartButton.Backdrop = Nil Then
		    StartButton.Backdrop = New Picture(StartButton.Width,StartButton.Height, 32)
		  End If
		  
		  'Clone From Wallpaper to Icon BG
		  StartButton.Backdrop.Graphics.DrawPicture(Main.Backdrop,0,0,StartButton.Width, StartButton.Height, StartButton.Left, StartButton.Top, StartButton.Width, StartButton.Height)
		  
		  StartButton.Backdrop.Graphics.DrawPicture(DefaultStartButton,0,0,StartButton.Width, StartButton.Height,0,0,DefaultStartButton.Width, DefaultStartButton.Height)
		  StartButton.Refresh
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events FirstShown
	#tag Event
		Sub Action()
		  ResizeMainForm
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events MetaData
	#tag Event
		Function PaintCellBackground(g As Graphics, row As Integer, column As Integer) As Boolean
		  'If Main.Visible = False Then Return False ' Don't redraw if not seen 'This may be breaking Wayland, try this fix
		  
		  'Can Do Solid Color
		  'g.DrawingColor =  &C000000
		  'g.FillRectangle(0,0,g.Width, g.Height)
		  
		  'Draw Wallpaper (Transparent)
		  Try
		    g.DrawPicture Main.Backdrop, -MetaData.Left, (-MetaData.Top)-(row*me.RowHeight) +(Me.ScrollPosition*me.RowHeight)
		  Catch
		  End Try
		End Function
	#tag EndEvent
	#tag Event
		Function PaintCellText(g as Graphics, row as Integer, column as Integer, x as Integer, y as Integer) As Boolean
		  'If Main.Visible = False Then Return False ' Don't redraw if not seen 'This may be breaking Wayland, try this fix
		  '#Pragma BreakOnExceptions False
		  
		  #PRAGMA unused x
		  #PRAGMA unused y
		  
		  Dim Pos As Integer
		  
		  Try
		    Pos = 2+(g.Height / 6)
		    
		    g.DrawingColor = ColMeta
		    g.FontName = FontMeta
		  Catch
		  End Try
		  
		  #Pragma BreakOnExceptions False
		  Try 'Ignore no items
		    If g <> Nil Then
		      g.DrawText(MetaData.CellTextAt(row, column), 0, g.Height-Pos)
		    End If
		  Catch
		  End Try
		  #Pragma BreakOnExceptions True
		  
		  Return True
		End Function
	#tag EndEvent
	#tag Event
		Sub MouseUp(x As Integer, y As Integer)
		  'Open URL if click anywhere on MetaData
		  Dim I As Integer
		  Dim Urls() As String
		  If Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("URL")) <> "" Then
		    Urls() = Data.Items.CellTextAt(CurrentItemID, Data.GetDBHeader("URL")).Split("|")
		    If Urls.Count >= 0 Then
		      For I = 0 To Urls.Count - 1
		        System.GotoURL(Urls(I).Trim)
		      Next
		    Else
		      System.GotoURL(Urls(0).Trim)
		    End If
		  End If
		End Sub
	#tag EndEvent
	#tag Event
		Function MouseDown(x As Integer, y As Integer) As Boolean
		  Return True
		End Function
	#tag EndEvent
	#tag Event
		Function MouseWheel(x As Integer, y As Integer, deltaX As Integer, deltaY As Integer) As Boolean
		  If Keyboard.AsyncControlKey Then 'Hold Ctrl to Zoom
		    If deltaY > 1 Then 'Zoom Out
		      MetaData.FontSize = MetaData.FontSize - 1
		      If MetaData.FontSize <= 4 Then MetaData.FontSize = 4
		    End If
		    
		    If deltaY < -1 Then 'Zoom In
		      MetaData.FontSize = MetaData.FontSize + 1
		      If MetaData.FontSize >= 18 Then MetaData.FontSize = 18
		    End If
		    Return True 'Stops Listbox Scrolling when zooming it
		  End If
		End Function
	#tag EndEvent
#tag EndEvents
#tag Events KeyTimer
	#tag Event
		Sub Action()
		  'Resets searching for items as you type
		  Typing = False
		  Typed = ""
		  KeyTimer.Mode = 0
		End Sub
	#tag EndEvent
#tag EndEvents
#tag Events DoContextTimer
	#tag Event
		Sub Action()
		  'App.DoEvents(1) 'Hopefully change items before context menu when you right click?
		  'If WasContext = True Then
		  'WasContext = False
		  DoContextMenu
		  'End If
		End Sub
	#tag EndEvent
#tag EndEvents
#tag ViewBehavior
	#tag ViewProperty
		Name="Name"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Interfaces"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Super"
		Visible=true
		Group="ID"
		InitialValue=""
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Width"
		Visible=true
		Group="Size"
		InitialValue="600"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Height"
		Visible=true
		Group="Size"
		InitialValue="400"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MinimumWidth"
		Visible=true
		Group="Size"
		InitialValue="64"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MinimumHeight"
		Visible=true
		Group="Size"
		InitialValue="64"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MaximumWidth"
		Visible=true
		Group="Size"
		InitialValue="32000"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MaximumHeight"
		Visible=true
		Group="Size"
		InitialValue="32000"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Type"
		Visible=true
		Group="Frame"
		InitialValue="0"
		Type="Types"
		EditorType="Enum"
		#tag EnumValues
			"0 - Document"
			"1 - Movable Modal"
			"2 - Modal Dialog"
			"3 - Floating Window"
			"4 - Plain Box"
			"5 - Shadowed Box"
			"6 - Rounded Window"
			"7 - Global Floating Window"
			"8 - Sheet Window"
			"9 - Modeless Dialog"
		#tag EndEnumValues
	#tag EndViewProperty
	#tag ViewProperty
		Name="Title"
		Visible=true
		Group="Frame"
		InitialValue="Untitled"
		Type="String"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasCloseButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasMaximizeButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasMinimizeButton"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasFullScreenButton"
		Visible=true
		Group="Frame"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Resizeable"
		Visible=true
		Group="Frame"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Composite"
		Visible=false
		Group="OS X (Carbon)"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MacProcID"
		Visible=false
		Group="OS X (Carbon)"
		InitialValue="0"
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="FullScreen"
		Visible=true
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="DefaultLocation"
		Visible=true
		Group="Behavior"
		InitialValue="2"
		Type="Locations"
		EditorType="Enum"
		#tag EnumValues
			"0 - Default"
			"1 - Parent Window"
			"2 - Main Screen"
			"3 - Parent Window Screen"
			"4 - Stagger"
		#tag EndEnumValues
	#tag EndViewProperty
	#tag ViewProperty
		Name="Visible"
		Visible=true
		Group="Behavior"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="ImplicitInstance"
		Visible=true
		Group="Window Behavior"
		InitialValue="True"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HasBackgroundColor"
		Visible=true
		Group="Background"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="BackgroundColor"
		Visible=true
		Group="Background"
		InitialValue="&cFFFFFF"
		Type="ColorGroup"
		EditorType="ColorGroup"
	#tag EndViewProperty
	#tag ViewProperty
		Name="Backdrop"
		Visible=true
		Group="Background"
		InitialValue=""
		Type="Picture"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MenuBar"
		Visible=true
		Group="Menus"
		InitialValue=""
		Type="DesktopMenuBar"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="MenuBarVisible"
		Visible=true
		Group="Deprecated"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="CurrentCat"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="String"
		EditorType="MultiLineEditor"
	#tag EndViewProperty
	#tag ViewProperty
		Name="CurrentCatID"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="SelectsCount"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Typed"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="String"
		EditorType="MultiLineEditor"
	#tag EndViewProperty
	#tag ViewProperty
		Name="Typing"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideInstalled"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideFree"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideLocal"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideOnline"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideOpen"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HidePaid"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideLLApps"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideLLGames"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideppApps"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideppGames"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HidessApps"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideNotInstalled"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="Untitled"
		Visible=false
		Group="Behavior"
		InitialValue=""
		Type="Integer"
		EditorType=""
	#tag EndViewProperty
	#tag ViewProperty
		Name="HideUnsetFlags"
		Visible=false
		Group="Behavior"
		InitialValue="False"
		Type="Boolean"
		EditorType=""
	#tag EndViewProperty
#tag EndViewBehavior
